        correctAnswer = correctIndex,
        explanation = "正确答案：" .. whGroup.wh .. "\n解析：" .. whGroup.wh .. " 一般用于" .. template.cn
    }
end

-- 生成音标匹配题
function QuestionGenerator.generatePhoneticMatch(words, variation)
    local wordsWithPhonetic = {}
    for _, w in ipairs(words) do
        if w.phonetic then
            table.insert(wordsWithPhonetic, w)
        end
    end
    if #wordsWithPhonetic < 4 then return nil end
    
    local word = wordsWithPhonetic[math.random(1, #wordsWithPhonetic)]
    local options = randomSelect(wordsWithPhonetic, 3, {word})
    table.insert(options, word)
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt.en == word.en then
            correctIndex = i
            break
        end
    end
    
    local templates = {
        "音标 " .. word.phonetic .. " 对应哪个单词？",
        "选择与音标 " .. word.phonetic .. " 匹配的单词：",
        "哪个单词的读音是 " .. word.phonetic .. " ？",
    }
    
    return {
        type = QuestionGenerator.TYPE.PHONETIC_MATCH,
        question = templates[math.random(1, #templates)],
        options = {options[1].en, options[2].en, options[3].en, options[4].en},
        correctAnswer = correctIndex,
        word = word,
        showPhonetic = true,
        explanation = (function()
            local parts = {"正确答案：" .. word.en}
            -- 优先使用词汇表中的拆解数据
            if word.breakdown then
                table.insert(parts, "音形拆解：")
                table.insert(parts, "  " .. word.breakdown.letters)
                table.insert(parts, "  " .. word.breakdown.sounds)
                table.insert(parts, "解析：" .. word.breakdown.tips)
            else
                -- 备用：自动生成的解析
                local vowelType = getMainVowelType(word.phonetic)
                if vowelType then
                    table.insert(parts, "解析：主要元音为" .. vowelType)
                end
            end
            return table.concat(parts, "\n")
        end)()
    }
end

-- 生成看音标拼写题
function QuestionGenerator.generateSpellingWithPhonetic(words, variation)
    local wordsWithPhonetic = {}
    for _, w in ipairs(words) do
        if w.phonetic and #w.en <= 8 then
            table.insert(wordsWithPhonetic, w)
        end
    end
    if #wordsWithPhonetic == 0 then return nil end
    
    local word = wordsWithPhonetic[math.random(1, #wordsWithPhonetic)]
    
    return {
        type = QuestionGenerator.TYPE.SPELLING_WITH_PHONETIC,
        question = "根据音标写出单词：",
        phoneticDisplay = word.phonetic,
        chineseHint = word.cn,
        options = nil,
        correctAnswer = word.en,
        word = word,
        isTextInput = true,
        showPhonetic = true,
        explanation = (function()
            local parts = {"正确答案：" .. word.en}
            if word.breakdown then
                table.insert(parts, "音形拆解：")
                table.insert(parts, "  " .. word.breakdown.letters)
                table.insert(parts, "  " .. word.breakdown.sounds)
                table.insert(parts, "解析：" .. word.breakdown.tips)
            else
                local vowelType = getMainVowelType(word.phonetic)
                if vowelType then
                    table.insert(parts, "解析：主要元音为" .. vowelType)
                end
            end
            return table.concat(parts, "\n")
        end)()
    }
end

-- 生成看单词选音标题
function QuestionGenerator.generateWordToPhonetic(words, variation)
    local wordsWithPhonetic = {}
    for _, w in ipairs(words) do
        if w.phonetic then
            table.insert(wordsWithPhonetic, w)
        end
    end
    if #wordsWithPhonetic < 4 then return nil end
    
    local word = wordsWithPhonetic[math.random(1, #wordsWithPhonetic)]
    local options = randomSelect(wordsWithPhonetic, 3, {word})
    table.insert(options, word)
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt.en == word.en then
            correctIndex = i
            break
        end
    end
    
    local templates = {
        '单词 "' .. word.en .. '" 的音标是？',
        '选择 "' .. word.en .. '" 的正确读音：',
        '"' .. word.en .. '" 怎么读？选择正确的音标：',
    }
    
    return {
        type = QuestionGenerator.TYPE.WORD_TO_PHONETIC,
        question = templates[math.random(1, #templates)],
        wordDisplay = word.en,
        chineseHint = word.cn,
        options = {options[1].phonetic, options[2].phonetic, options[3].phonetic, options[4].phonetic},
        correctAnswer = correctIndex,
        word = word,
        showPhonetic = false,
        explanation = (function()
            local parts = {"正确答案：" .. word.phonetic}
            if word.breakdown then
                table.insert(parts, "音形拆解：")
                table.insert(parts, "  " .. word.breakdown.letters)
                table.insert(parts, "  " .. word.breakdown.sounds)
                table.insert(parts, "解析：" .. word.breakdown.tips)
            else
                local vowelType = getMainVowelType(word.phonetic)
                if vowelType then
                    table.insert(parts, "解析：主要元音为" .. vowelType)
                end
            end
            return table.concat(parts, "\n")
        end)()
    }
end

-- ============================================================================
-- 知识专项配置（每个专项独立题库）
-- ============================================================================

<file-read-info>Read lines 890-160. </file-read-info>


-- ============================================================================
-- 题目生成系统 - 根据难度生成不同类型的英语练习题 (增强版)
-- 每个知识专项独立生成500+题，支持音标显示
-- ============================================================================

local Vocabulary = require "vocabulary"

local QuestionGenerator = {}

-- 题目类型枚举
QuestionGenerator.TYPE = {
    TRANSLATE_CN_TO_EN = 1,
    TRANSLATE_EN_TO_CN = 2,
    ARTICLE_A_AN = 3,
    VERB_THIRD_PERSON = 4,
    PRONOUN_CASE = 5,
    NOUN_PLURAL = 6,
    FILL_BLANK = 7,
    SENTENCE_PATTERN = 8,
    WH_QUESTION = 9,
    PHONETIC_MATCH = 10,       -- 看音标选单词
    SPELLING_WITH_PHONETIC = 11, -- 看音标拼写
    WORD_TO_PHONETIC = 12,     -- 看单词选音标
}

-- 难度配置（综合挑战使用，包含所有专项）
QuestionGenerator.DIFFICULTY = {
    LOW = {
        name = "初级",
        totalQuestions = 50,
        types = {
            QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
            QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
            QuestionGenerator.TYPE.ARTICLE_A_AN,
            QuestionGenerator.TYPE.PHONETIC_MATCH,
            QuestionGenerator.TYPE.WORD_TO_PHONETIC,
        }
    },
    MEDIUM = {
        name = "中级",
        totalQuestions = 150,
        types = {
            QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
            QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
            QuestionGenerator.TYPE.ARTICLE_A_AN,
            QuestionGenerator.TYPE.VERB_THIRD_PERSON,
            QuestionGenerator.TYPE.PRONOUN_CASE,
            QuestionGenerator.TYPE.PHONETIC_MATCH,
            QuestionGenerator.TYPE.WORD_TO_PHONETIC,
            QuestionGenerator.TYPE.NOUN_PLURAL,
        }
    },
    HIGH = {
        name = "高级",
        totalQuestions = 350,
        types = {
            QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
            QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
            QuestionGenerator.TYPE.ARTICLE_A_AN,
            QuestionGenerator.TYPE.VERB_THIRD_PERSON,
            QuestionGenerator.TYPE.PRONOUN_CASE,
            QuestionGenerator.TYPE.NOUN_PLURAL,
            QuestionGenerator.TYPE.FILL_BLANK,
            QuestionGenerator.TYPE.SENTENCE_PATTERN,
            QuestionGenerator.TYPE.WH_QUESTION,
            QuestionGenerator.TYPE.PHONETIC_MATCH,
            QuestionGenerator.TYPE.WORD_TO_PHONETIC,
            QuestionGenerator.TYPE.SPELLING_WITH_PHONETIC,
        }
    }
}

-- ============================================================================
-- 音标类型和音形拆解系统
-- ============================================================================

-- 音标类型分类
local phoneticTypes = {
    -- 单元音 (短元音)
    ["ɪ"] = "短元音", ["e"] = "短元音", ["æ"] = "短元音", 
    ["ɒ"] = "短元音", ["ʊ"] = "短元音", ["ʌ"] = "短元音", ["ə"] = "短元音",
    -- 单元音 (长元音)
    ["iː"] = "长元音", ["ɑː"] = "长元音", ["ɔː"] = "长元音", 
    ["uː"] = "长元音", ["ɜː"] = "长元音",
    -- 双元音
    ["eɪ"] = "双元音", ["aɪ"] = "双元音", ["ɔɪ"] = "双元音",
    ["əʊ"] = "双元音", ["aʊ"] = "双元音", ["ɪə"] = "双元音", 
    ["eə"] = "双元音", ["ʊə"] = "双元音",
    -- 爆破音
    ["p"] = "爆破音", ["b"] = "爆破音", ["t"] = "爆破音", 
    ["d"] = "爆破音", ["k"] = "爆破音", ["g"] = "爆破音",
    -- 摩擦音
    ["f"] = "摩擦音", ["v"] = "摩擦音", ["θ"] = "摩擦音", 
    ["ð"] = "摩擦音", ["s"] = "摩擦音", ["z"] = "摩擦音", 
    ["ʃ"] = "摩擦音", ["ʒ"] = "摩擦音", ["h"] = "摩擦音",
    -- 破擦音
    ["tʃ"] = "破擦音", ["dʒ"] = "破擦音",
    -- 鼻音
    ["m"] = "鼻音", ["n"] = "鼻音", ["ŋ"] = "鼻音",
    -- 舌边音
    ["l"] = "舌边音",
    -- 半元音
    ["w"] = "半元音", ["j"] = "半元音",
    -- 颤音
    ["r"] = "颤音",
}

-- 常见字母组合到音标的映射（用于音形拆解）
local letterToPhonetic = {
    -- 元音字母组合
    ["ee"] = "/iː/ 长元音", ["ea"] = "/iː/ 长元音", 
    ["oo"] = "/uː/ 长元音", ["ou"] = "/aʊ/ 双元音", ["ow"] = "/aʊ/ 双元音",
    ["ai"] = "/eɪ/ 双元音", ["ay"] = "/eɪ/ 双元音",
    ["oi"] = "/ɔɪ/ 双元音", ["oy"] = "/ɔɪ/ 双元音",
    ["ar"] = "/ɑː/ 长元音", ["or"] = "/ɔː/ 长元音", ["er"] = "/ɜː/ 长元音",
    ["ir"] = "/ɜː/ 长元音", ["ur"] = "/ɜː/ 长元音",
    -- 辅音字母组合
    ["sh"] = "/ʃ/ 摩擦音", ["ch"] = "/tʃ/ 破擦音", ["th"] = "/θ/ 摩擦音",
    ["ng"] = "/ŋ/ 鼻音", ["ck"] = "/k/ 爆破音", ["ph"] = "/f/ 摩擦音",
    ["wh"] = "/w/ 半元音", ["wr"] = "/r/ 颤音", ["kn"] = "/n/ 鼻音",
    ["mb"] = "/m/ 鼻音", ["gh"] = "不发音",
}

-- 生成音形拆解说明
local function generatePhoneticBreakdown(word, phonetic)
    if not phonetic then return nil end
    
    -- 简化版：识别单词中的主要音素并给出类型说明
    local breakdown = {}
    local wordLower = string.lower(word)
    
    -- 检查常见字母组合
    for combo, desc in pairs(letterToPhonetic) do
        if string.find(wordLower, combo) then
            table.insert(breakdown, combo .. " → " .. desc)
        end
    end
    
    -- 如果没有找到组合，返回基本说明
    if #breakdown == 0 then
        return nil
    end
    
    return table.concat(breakdown, "\n")
end

-- 获取音标中主要元音的类型
local function getMainVowelType(phonetic)
    if not phonetic then return "元音" end
    
    -- 检查双元音（先检查，因为更长）
    local diphthongs = {"eɪ", "aɪ", "ɔɪ", "əʊ", "aʊ", "ɪə", "eə", "ʊə"}
    for _, d in ipairs(diphthongs) do
        if string.find(phonetic, d) then
            return "双元音 /" .. d .. "/"
        end
    end
    
    -- 检查长元音
    local longVowels = {"iː", "ɑː", "ɔː", "uː", "ɜː"}
    for _, v in ipairs(longVowels) do
        if string.find(phonetic, v) then
            return "长元音 /" .. v .. "/"
        end
    end
    
    -- 检查短元音
    local shortVowels = {"ɪ", "e", "æ", "ɒ", "ʊ", "ʌ", "ə"}
    for _, v in ipairs(shortVowels) do
        if string.find(phonetic, v) then
            return "短元音 /" .. v .. "/"
        end
    end
    
    return nil
end

-- 随机洗牌函数
local function shuffle(tbl)
    local result = {}



-- ============================================================================
-- 英语词汇数据模块 - 基于六年级课本 Unit 1-6 (含音标)
-- ============================================================================

local Vocabulary = {}

-- Unit 1 词汇 (含音标)
Vocabulary.unit1 = {
    {en = "life", cn = "生活；生命", phonetic = "/laɪf/", type = "noun", plural = "lives",
        breakdown = {letters = "l - i - fe", sounds = "/l/ - /aɪ/ - /f/", tips = "i为双元音/aɪ/"}},
    {en = "break", cn = "课间休息；间歇", phonetic = "/breɪk/", type = "noun",
        breakdown = {letters = "br - ea - k", sounds = "/br/ - /eɪ/ - /k/", tips = "ea为双元音/eɪ/"}},
    {en = "ICT", cn = "信息通信技术", phonetic = "/ˌaɪ siː ˈtiː/", type = "noun"},
    {en = "geography", cn = "地理", phonetic = "/dʒiˈɒɡrəfi/", type = "noun",
        breakdown = {letters = "ge - o - gra - phy", sounds = "/dʒi/ - /ˈɒ/ - /ɡrə/ - /fi/", tips = "ge发/dʒ/"}},
    {en = "history", cn = "历史", phonetic = "/ˈhɪstri/", type = "noun",
        breakdown = {letters = "h - i - s - t - o - ry", sounds = "/h/ - /ɪ/ - /s/ - /t/ - /ə/ - /ri/", tips = "i为短元音/ɪ/"}},
    {en = "more", cn = "更多的", phonetic = "/mɔː(r)/", type = "det",
        breakdown = {letters = "m - ore", sounds = "/m/ - /ɔː/", tips = "ore为长元音/ɔː/"}},
    {en = "instruction", cn = "指示；命令", phonetic = "/ɪnˈstrʌkʃn/", type = "noun"},
    {en = "experiment", cn = "实验；试验", phonetic = "/ɪkˈsperɪmənt/", type = "noun"},
    {en = "activity", cn = "活动", phonetic = "/ækˈtɪvəti/", type = "noun", plural = "activities"},
    {en = "club", cn = "社团；俱乐部", phonetic = "/klʌb/", type = "noun",
        breakdown = {letters = "cl - u - b", sounds = "/kl/ - /ʌ/ - /b/", tips = "u为短元音/ʌ/"}},
    {en = "calligraphy", cn = "书法", phonetic = "/kəˈlɪɡrəfi/", type = "noun"},
    {en = "join", cn = "加入", phonetic = "/dʒɔɪn/", type = "verb", thirdPerson = "joins",
        breakdown = {letters = "j - oi - n", sounds = "/dʒ/ - /ɔɪ/ - /n/", tips = "oi为双元音/ɔɪ/"}},
    {en = "technology", cn = "科技", phonetic = "/tekˈnɒlədʒi/", type = "noun"},
    {en = "everyone", cn = "每个人", phonetic = "/ˈevriwʌn/", type = "pron"},
    {en = "lab", cn = "实验室", phonetic = "/læb/", type = "noun",
        breakdown = {letters = "l - a - b", sounds = "/l/ - /æ/ - /b/", tips = "a为短元音/æ/"}},
    {en = "field", cn = "场地", phonetic = "/fiːld/", type = "noun",
        breakdown = {letters = "f - ie - ld", sounds = "/f/ - /iː/ - /ld/", tips = "ie为长元音/iː/"}},
    {en = "grade", cn = "年级", phonetic = "/ɡreɪd/", type = "noun",
        breakdown = {letters = "gr - a - de", sounds = "/ɡr/ - /eɪ/ - /d/", tips = "a_e为双元音/eɪ/"}},
    {en = "excuse", cn = "原谅；宽恕", phonetic = "/ɪkˈskjuːz/", type = "verb", thirdPerson = "excuses"},
    {en = "project", cn = "项目", phonetic = "/ˈprɒdʒekt/", type = "noun"},
    {en = "start", cn = "开始", phonetic = "/stɑːt/", type = "verb", thirdPerson = "starts",
        breakdown = {letters = "st - ar - t", sounds = "/st/ - /ɑː/ - /t/", tips = "ar为长元音/ɑː/"}},
    {en = "topic", cn = "话题；主题", phonetic = "/ˈtɒpɪk/", type = "noun",
        breakdown = {letters = "t - o - p - i - c", sounds = "/t/ - /ɒ/ - /p/ - /ɪ/ - /k/", tips = "o为短元音/ɒ/"}},
    {en = "online", cn = "在线的；联网的", phonetic = "/ˌɒnˈlaɪn/", type = "adj",
        breakdown = {letters = "on - l - i - ne", sounds = "/ɒn/ - /l/ - /aɪ/ - /n/", tips = "i_e为双元音/aɪ/"}},
    {en = "receive", cn = "接到；收到", phonetic = "/rɪˈsiːv/", type = "verb", thirdPerson = "receives",
        breakdown = {letters = "r - e - c - ei - ve", sounds = "/r/ - /ɪ/ - /s/ - /iː/ - /v/", tips = "ei为长元音/iː/"}},
    {en = "reply", cn = "回答；答复", phonetic = "/rɪˈplaɪ/", type = "noun", plural = "replies",
        breakdown = {letters = "r - e - pl - y", sounds = "/r/ - /ɪ/ - /pl/ - /aɪ/", tips = "y为双元音/aɪ/"}},
    {en = "group", cn = "组；群；类", phonetic = "/ɡruːp/", type = "noun",
        breakdown = {letters = "gr - ou - p", sounds = "/ɡr/ - /uː/ - /p/", tips = "ou为长元音/uː/"}},
    {en = "most", cn = "最", phonetic = "/məʊst/", type = "adv",
        breakdown = {letters = "m - o - st", sounds = "/m/ - /əʊ/ - /st/", tips = "o为双元音/əʊ/"}},
    {en = "end", cn = "结束", phonetic = "/end/", type = "verb", thirdPerson = "ends",
        breakdown = {letters = "e - n - d", sounds = "/e/ - /n/ - /d/", tips = "e为短元音/e/"}},
    {en = "difference", cn = "差别；不同之处", phonetic = "/ˈdɪfrəns/", type = "noun"},
    {en = "same", cn = "一样的", phonetic = "/seɪm/", type = "adj",
        breakdown = {letters = "s - a - me", sounds = "/s/ - /eɪ/ - /m/", tips = "a_e为双元音/eɪ/"}},
    {en = "during", cn = "在……期间", phonetic = "/ˈdjʊərɪŋ/", type = "prep"},
    {en = "outside", cn = "在外面", phonetic = "/ˌaʊtˈsaɪd/", type = "adv",
        breakdown = {letters = "ou - t - s - i - de", sounds = "/aʊ/ - /t/ - /s/ - /aɪ/ - /d/", tips = "ou为双元音/aʊ/，i_e为双元音/aɪ/"}},
    {en = "noon", cn = "正午；中午", phonetic = "/nuːn/", type = "noun",
        breakdown = {letters = "n - oo - n", sounds = "/n/ - /uː/ - /n/", tips = "oo为长元音/uː/"}},
    {en = "connect", cn = "连接", phonetic = "/kəˈnekt/", type = "verb", thirdPerson = "connects"},
    {en = "comment", cn = "议论；评论", phonetic = "/ˈkɒment/", type = "noun"},
}

-- Unit 2 词汇 (含音标)
Vocabulary.unit2 = {
    {en = "tie", cn = "联系；关系；纽带", phonetic = "/taɪ/", type = "noun",
        breakdown = {letters = "t - ie", sounds = "/t/ - /aɪ/", tips = "ie为双元音/aɪ/"}},
    {en = "relation", cn = "关系；联系", phonetic = "/rɪˈleɪʃn/", type = "noun",
        breakdown = {letters = "r - e - l - a - tion", sounds = "/r/ - /ɪ/ - /l/ - /eɪ/ - /ʃn/", tips = "a为双元音/eɪ/，tion发/ʃn/"}},
    {en = "introduce", cn = "介绍", phonetic = "/ˌɪntrəˈdjuːs/", type = "verb", thirdPerson = "introduces",
        breakdown = {letters = "in - tro - duce", sounds = "/ɪn/ - /trə/ - /djuːs/", tips = "u为长元音/uː/"}},
    {en = "classmate", cn = "同班同学", phonetic = "/ˈklɑːsmeɪt/", type = "noun",
        breakdown = {letters = "cl - a - ss - m - a - te", sounds = "/kl/ - /ɑː/ - /s/ - /m/ - /eɪ/ - /t/", tips = "第一个a为长元音/ɑː/，a_e为双元音/eɪ/"}},
    {en = "relative", cn = "亲戚；亲属", phonetic = "/ˈrelətɪv/", type = "noun",
        breakdown = {letters = "r - e - l - a - t - ive", sounds = "/r/ - /e/ - /l/ - /ə/ - /t/ - /ɪv/", tips = "第一个e为短元音/e/"}},
    {en = "only", cn = "仅有的；唯一的", phonetic = "/ˈəʊnli/", type = "adj",
        breakdown = {letters = "o - n - ly", sounds = "/əʊ/ - /n/ - /li/", tips = "o为双元音/əʊ/"}},
    {en = "twin", cn = "双胞胎之一", phonetic = "/twɪn/", type = "noun",
        breakdown = {letters = "tw - i - n", sounds = "/tw/ - /ɪ/ - /n/", tips = "i为短元音/ɪ/"}},
    {en = "husband", cn = "丈夫", phonetic = "/ˈhʌzbənd/", type = "noun",
        breakdown = {letters = "h - u - s - b - a - nd", sounds = "/h/ - /ʌ/ - /z/ - /b/ - /ə/ - /nd/", tips = "u为短元音/ʌ/"}},
    {en = "wife", cn = "妻子", phonetic = "/waɪf/", type = "noun", plural = "wives",
        breakdown = {letters = "w - i - fe", sounds = "/w/ - /aɪ/ - /f/", tips = "i_e为双元音/aɪ/"}},
    {en = "son", cn = "儿子", phonetic = "/sʌn/", type = "noun",
        breakdown = {letters = "s - o - n", sounds = "/s/ - /ʌ/ - /n/", tips = "o发短元音/ʌ/"}},
    {en = "daughter", cn = "女儿", phonetic = "/ˈdɔːtə(r)/", type = "noun",
        breakdown = {letters = "d - augh - ter", sounds = "/d/ - /ɔː/ - /tə/", tips = "augh为长元音/ɔː/"}},
    {en = "other", cn = "另外；其他", phonetic = "/ˈʌðə(r)/", type = "pron",
        breakdown = {letters = "o - th - er", sounds = "/ʌ/ - /ð/ - /ə/", tips = "th为浊摩擦音/ð/"}},
    {en = "member", cn = "成员；分子", phonetic = "/ˈmembə(r)/", type = "noun",
        breakdown = {letters = "m - e - m - ber", sounds = "/m/ - /e/ - /m/ - /bə/", tips = "e为短元音/e/"}},
    {en = "add", cn = "添加；增加", phonetic = "/æd/", type = "verb", thirdPerson = "adds",
        breakdown = {letters = "a - dd", sounds = "/æ/ - /d/", tips = "a为短元音/æ/"}},
    {en = "note", cn = "笔记；记录", phonetic = "/nəʊt/", type = "noun",
        breakdown = {letters = "n - o - te", sounds = "/n/ - /əʊ/ - /t/", tips = "o_e为双元音/əʊ/"}},
    {en = "album", cn = "相册；影集", phonetic = "/ˈælbəm/", type = "noun",
        breakdown = {letters = "al - b - um", sounds = "/æl/ - /b/ - /əm/", tips = "a为短元音/æ/"}},
    {en = "teach", cn = "教", phonetic = "/tiːtʃ/", type = "verb", thirdPerson = "teaches",
        breakdown = {letters = "t - ea - ch", sounds = "/t/ - /iː/ - /tʃ/", tips = "ea为长元音/iː/，ch为破擦音/tʃ/"}},
    {en = "homework", cn = "家庭作业", phonetic = "/ˈhəʊmwɜːk/", type = "noun",
        breakdown = {letters = "h - o - me - w - or - k", sounds = "/h/ - /əʊ/ - /m/ - /w/ - /ɜː/ - /k/", tips = "o_e为双元音/əʊ/，or为长元音/ɜː/"}},
    {en = "guitar", cn = "吉他", phonetic = "/ɡɪˈtɑː(r)/", type = "noun",
        breakdown = {letters = "g - ui - t - ar", sounds = "/ɡ/ - /ɪ/ - /t/ - /ɑː/", tips = "ar为长元音/ɑː/"}},
    {en = "elder", cn = "年长的", phonetic = "/ˈeldə(r)/", type = "adj",
        breakdown = {letters = "el - der", sounds = "/el/ - /də/", tips = "e为短元音/e/"}},
    {en = "sofa", cn = "长沙发", phonetic = "/ˈsəʊfə/", type = "noun",
        breakdown = {letters = "s - o - f - a", sounds = "/s/ - /əʊ/ - /f/ - /ə/", tips = "o为双元音/əʊ/"}},
    {en = "round", cn = "圆形的", phonetic = "/raʊnd/", type = "adj",
        breakdown = {letters = "r - ou - nd", sounds = "/r/ - /aʊ/ - /nd/", tips = "ou为双元音/aʊ/"}},
    {en = "dark", cn = "乌黑的；深色的", phonetic = "/dɑːk/", type = "adj",
        breakdown = {letters = "d - ar - k", sounds = "/d/ - /ɑː/ - /k/", tips = "ar为长元音/ɑː/"}},
    {en = "chess", cn = "国际象棋", phonetic = "/tʃes/", type = "noun",
        breakdown = {letters = "ch - e - ss", sounds = "/tʃ/ - /e/ - /s/", tips = "ch为破擦音/tʃ/，e为短元音/e/"}},
    {en = "duty", cn = "责任；义务", phonetic = "/ˈdjuːti/", type = "noun", plural = "duties",
        breakdown = {letters = "d - u - ty", sounds = "/dj/ - /uː/ - /ti/", tips = "u为长元音/uː/"}},
    {en = "born", cn = "出生", phonetic = "/bɔːn/", type = "verb",
        breakdown = {letters = "b - or - n", sounds = "/b/ - /ɔː/ - /n/", tips = "or为长元音/ɔː/"}},
    {en = "weekend", cn = "周末", phonetic = "/ˌwiːkˈend/", type = "noun",
        breakdown = {letters = "w - ee - k - e - nd", sounds = "/w/ - /iː/ - /k/ - /e/ - /nd/", tips = "ee为长元音/iː/"}},
    {en = "thing", cn = "事情；事件", phonetic = "/θɪŋ/", type = "noun",
        breakdown = {letters = "th - i - ng", sounds = "/θ/ - /ɪ/ - /ŋ/", tips = "th为清摩擦音/θ/，ng为鼻音/ŋ/"}},
    {en = "enough", cn = "足够地", phonetic = "/ɪˈnʌf/", type = "adv",
        breakdown = {letters = "e - n - ough", sounds = "/ɪ/ - /n/ - /ʌf/", tips = "ough发/ʌf/"}},
    {en = "dish", cn = "碟子；盘子", phonetic = "/dɪʃ/", type = "noun", plural = "dishes",
        breakdown = {letters = "d - i - sh", sounds = "/d/ - /ɪ/ - /ʃ/", tips = "sh为摩擦音/ʃ/"}},
    {en = "usually", cn = "通常地", phonetic = "/ˈjuːʒuəli/", type = "adv",
        breakdown = {letters = "u - su - al - ly", sounds = "/juː/ - /ʒu/ - /ə/ - /li/", tips = "u为长元音/uː/"}},
    {en = "quick", cn = "快的；迅速的", phonetic = "/kwɪk/", type = "adj",
        breakdown = {letters = "qu - i - ck", sounds = "/kw/ - /ɪ/ - /k/", tips = "qu发/kw/，i为短元音/ɪ/"}},
    {en = "together", cn = "在一起", phonetic = "/təˈɡeðə(r)/", type = "adv",
        breakdown = {letters = "to - ge - ther", sounds = "/tə/ - /ɡe/ - /ðə/", tips = "th为浊摩擦音/ð/"}},
    {en = "flat", cn = "公寓", phonetic = "/flæt/", type = "noun",
        breakdown = {letters = "fl - a - t", sounds = "/fl/ - /æ/ - /t/", tips = "a为短元音/æ/"}},
    {en = "fun", cn = "乐趣；快乐", phonetic = "/fʌn/", type = "noun",
        breakdown = {letters = "f - u - n", sounds = "/f/ - /ʌ/ - /n/", tips = "u为短元音/ʌ/"}},
    {en = "celebration", cn = "庆典", phonetic = "/ˌselɪˈbreɪʃn/", type = "noun",
        breakdown = {letters = "ce - le - br - a - tion", sounds = "/se/ - /lɪ/ - /br/ - /eɪ/ - /ʃn/", tips = "a为双元音/eɪ/，tion发/ʃn/"}},
    {en = "prepare", cn = "准备", phonetic = "/prɪˈpeə(r)/", type = "verb", thirdPerson = "prepares",
        breakdown = {letters = "pre - p - are", sounds = "/prɪ/ - /p/ - /eə/", tips = "are为双元音/eə/"}},
    {en = "decorate", cn = "装饰", phonetic = "/ˈdekəreɪt/", type = "verb", thirdPerson = "decorates",
        breakdown = {letters = "de - co - r - ate", sounds = "/de/ - /kə/ - /r/ - /eɪt/", tips = "ate为双元音/eɪ/"}},
    {en = "balloon", cn = "气球", phonetic = "/bəˈluːn/", type = "noun",
        breakdown = {letters = "ba - ll - oo - n", sounds = "/bə/ - /l/ - /uː/ - /n/", tips = "oo为长元音/uː/"}},
    {en = "set", cn = "放置；摆放", phonetic = "/set/", type = "verb", thirdPerson = "sets",
        breakdown = {letters = "s - e - t", sounds = "/s/ - /e/ - /t/", tips = "e为短元音/e/"}},
    {en = "surprised", cn = "惊讶的", phonetic = "/səˈpraɪzd/", type = "adj",
        breakdown = {letters = "sur - pr - i - sed", sounds = "/sə/ - /pr/ - /aɪ/ - /zd/", tips = "i为双元音/aɪ/"}},
    {en = "joy", cn = "高兴；愉快", phonetic = "/dʒɔɪ/", type = "noun",
        breakdown = {letters = "j - oy", sounds = "/dʒ/ - /ɔɪ/", tips = "oy为双元音/ɔɪ/"}},
}

-- Unit 3 词汇 (食物主题，含音标)
Vocabulary.unit3 = {
    {en = "something", cn = "某事；某物", phonetic = "/ˈsʌmθɪŋ/", type = "pron",
        breakdown = {letters = "s - o - me - th - ing", sounds = "/s/ - /ʌ/ - /m/ - /θ/ - /ɪŋ/", tips = "th为清摩擦音/θ/，ng为鼻音/ŋ/"}},
    {en = "beef", cn = "牛肉", phonetic = "/biːf/", type = "noun",
        breakdown = {letters = "b - ee - f", sounds = "/b/ - /iː/ - /f/", tips = "ee为长元音/iː/"}},
    {en = "tofu", cn = "豆腐", phonetic = "/ˈtəʊfuː/", type = "noun",
        breakdown = {letters = "t - o - f - u", sounds = "/t/ - /əʊ/ - /f/ - /uː/", tips = "o为双元音/əʊ/，u为长元音/uː/"}},
    {en = "pepper", cn = "甜椒", phonetic = "/ˈpepə(r)/", type = "noun",
        breakdown = {letters = "p - e - pp - er", sounds = "/p/ - /e/ - /p/ - /ə/", tips = "e为短元音/e/"}},
    {en = "cabbage", cn = "卷心菜", phonetic = "/ˈkæbɪdʒ/", type = "noun",
        breakdown = {letters = "c - a - bb - age", sounds = "/k/ - /æ/ - /b/ - /ɪdʒ/", tips = "a为短元音/æ/，age发/ɪdʒ/"}},
    {en = "onion", cn = "洋葱", phonetic = "/ˈʌnjən/", type = "noun",
        breakdown = {letters = "o - n - ion", sounds = "/ʌ/ - /n/ - /jən/", tips = "o发短元音/ʌ/"}},
    {en = "carrot", cn = "胡萝卜", phonetic = "/ˈkærət/", type = "noun",
        breakdown = {letters = "c - a - rr - ot", sounds = "/k/ - /æ/ - /r/ - /ət/", tips = "a为短元音/æ/"}},
    {en = "watermelon", cn = "西瓜", phonetic = "/ˈwɔːtəmelən/", type = "noun",
        breakdown = {letters = "wa - ter - me - lon", sounds = "/wɔː/ - /tə/ - /me/ - /lən/", tips = "wa发长元音/wɔː/"}},
    {en = "cucumber", cn = "黄瓜", phonetic = "/ˈkjuːkʌmbə(r)/", type = "noun",
        breakdown = {letters = "cu - cum - ber", sounds = "/kjuː/ - /kʌm/ - /bə/", tips = "u为长元音/uː/"}},
    {en = "strawberry", cn = "草莓", phonetic = "/ˈstrɔːbəri/", type = "noun", plural = "strawberries",
        breakdown = {letters = "str - aw - be - rry", sounds = "/str/ - /ɔː/ - /bə/ - /ri/", tips = "aw为长元音/ɔː/"}},
    {en = "pear", cn = "梨", phonetic = "/peə(r)/", type = "noun",
        breakdown = {letters = "p - ear", sounds = "/p/ - /eə/", tips = "ear为双元音/eə/"}},
    {en = "yogurt", cn = "酸奶", phonetic = "/ˈjɒɡət/", type = "noun",
        breakdown = {letters = "yo - gurt", sounds = "/jɒ/ - /ɡət/", tips = "o为短元音/ɒ/"}},
    {en = "cheese", cn = "干酪；奶酪", phonetic = "/tʃiːz/", type = "noun",
        breakdown = {letters = "ch - ee - se", sounds = "/tʃ/ - /iː/ - /z/", tips = "ch为破擦音/tʃ/，ee为长元音/iː/"}},
    {en = "corn", cn = "谷物；玉米", phonetic = "/kɔːn/", type = "noun",
        breakdown = {letters = "c - or - n", sounds = "/k/ - /ɔː/ - /n/", tips = "or为长元音/ɔː/"}},
    {en = "butter", cn = "黄油", phonetic = "/ˈbʌtə(r)/", type = "noun",
        breakdown = {letters = "b - u - tt - er", sounds = "/b/ - /ʌ/ - /t/ - /ə/", tips = "u为短元音/ʌ/"}},
    {en = "oil", cn = "食用油", phonetic = "/ɔɪl/", type = "noun",
        breakdown = {letters = "oi - l", sounds = "/ɔɪ/ - /l/", tips = "oi为双元音/ɔɪ/"}},
    {en = "salt", cn = "盐；食盐", phonetic = "/sɔːlt/", type = "noun",
        breakdown = {letters = "s - al - t", sounds = "/s/ - /ɔːl/ - /t/", tips = "al发/ɔːl/"}},
    {en = "bean", cn = "豆", phonetic = "/biːn/", type = "noun",
        breakdown = {letters = "b - ea - n", sounds = "/b/ - /iː/ - /n/", tips = "ea为长元音/iː/"}},
    {en = "product", cn = "产品；制品", phonetic = "/ˈprɒdʌkt/", type = "noun",
        breakdown = {letters = "pr - o - d - uct", sounds = "/pr/ - /ɒ/ - /d/ - /ʌkt/", tips = "o为短元音/ɒ/"}},
    {en = "grain", cn = "谷物；谷粒", phonetic = "/ɡreɪn/", type = "noun",
        breakdown = {letters = "gr - ai - n", sounds = "/ɡr/ - /eɪ/ - /n/", tips = "ai为双元音/eɪ/"}},
    {en = "rainbow", cn = "虹；彩虹", phonetic = "/ˈreɪnbəʊ/", type = "noun",
        breakdown = {letters = "r - ai - n - b - ow", sounds = "/r/ - /eɪ/ - /n/ - /b/ - /əʊ/", tips = "ai为双元音/eɪ/，ow为双元音/əʊ/"}},
    {en = "balanced", cn = "平衡的", phonetic = "/ˈbælənst/", type = "adj",
        breakdown = {letters = "b - a - l - anced", sounds = "/b/ - /æ/ - /l/ - /ənst/", tips = "a为短元音/æ/"}},
    {en = "diet", cn = "日常饮食", phonetic = "/ˈdaɪət/", type = "noun",
        breakdown = {letters = "d - i - et", sounds = "/d/ - /aɪ/ - /ət/", tips = "i为双元音/aɪ/"}},
    {en = "each", cn = "各自；每个", phonetic = "/iːtʃ/", type = "det",
        breakdown = {letters = "ea - ch", sounds = "/iː/ - /tʃ/", tips = "ea为长元音/iː/，ch为破擦音/tʃ/"}},
    {en = "plenty", cn = "大量", phonetic = "/ˈplenti/", type = "pron",
        breakdown = {letters = "pl - e - n - ty", sounds = "/pl/ - /e/ - /n/ - /ti/", tips = "e为短元音/e/"}},
    {en = "choice", cn = "选择；挑选", phonetic = "/tʃɔɪs/", type = "noun",
        breakdown = {letters = "ch - oi - ce", sounds = "/tʃ/ - /ɔɪ/ - /s/", tips = "ch为破擦音/tʃ/，oi为双元音/ɔɪ/"}},
    {en = "list", cn = "一览表；清单", phonetic = "/lɪst/", type = "noun",
        breakdown = {letters = "l - i - st", sounds = "/l/ - /ɪ/ - /st/", tips = "i为短元音/ɪ/"}},
    {en = "few", cn = "不多；很少", phonetic = "/fjuː/", type = "det",
        breakdown = {letters = "f - ew", sounds = "/f/ - /juː/", tips = "ew发/juː/"}},
    {en = "pleasure", cn = "高兴；快乐", phonetic = "/ˈpleʒə(r)/", type = "noun",
        breakdown = {letters = "pl - ea - sure", sounds = "/pl/ - /e/ - /ʒə/", tips = "ea发短元音/e/，s发/ʒ/"}},
    {en = "ingredient", cn = "材料；成分", phonetic = "/ɪnˈɡriːdiənt/", type = "noun",
        breakdown = {letters = "in - gre - di - ent", sounds = "/ɪn/ - /ɡriː/ - /di/ - /ənt/", tips = "e为长元音/iː/"}},
    {en = "tasty", cn = "美味的", phonetic = "/ˈteɪsti/", type = "adj",
        breakdown = {letters = "t - as - ty", sounds = "/t/ - /eɪs/ - /ti/", tips = "a发双元音/eɪ/"}},
    {en = "need", cn = "需要", phonetic = "/niːd/", type = "verb", thirdPerson = "needs",
        breakdown = {letters = "n - ee - d", sounds = "/n/ - /iː/ - /d/", tips = "ee为长元音/iː/"}},
    {en = "fridge", cn = "冰箱", phonetic = "/frɪdʒ/", type = "noun",
        breakdown = {letters = "fr - i - dge", sounds = "/fr/ - /ɪ/ - /dʒ/", tips = "i为短元音/ɪ/，dge发/dʒ/"}},
    {en = "surprise", cn = "意想不到的事", phonetic = "/səˈpraɪz/", type = "noun",
        breakdown = {letters = "sur - pr - i - se", sounds = "/sə/ - /pr/ - /aɪ/ - /z/", tips = "i为双元音/aɪ/"}},
    {en = "blog", cn = "博客", phonetic = "/blɒɡ/", type = "noun",
        breakdown = {letters = "bl - o - g", sounds = "/bl/ - /ɒ/ - /ɡ/", tips = "o为短元音/ɒ/"}},
    {en = "as", cn = "作为；当作", phonetic = "/æz/", type = "prep",
        breakdown = {letters = "a - s", sounds = "/æ/ - /z/", tips = "a为短元音/æ/"}},
    {en = "into", cn = "进入", phonetic = "/ˈɪntə/", type = "prep",
        breakdown = {letters = "in - to", sounds = "/ɪn/ - /tə/", tips = "i为短元音/ɪ/"}},
    {en = "piece", cn = "碎片；碎块", phonetic = "/piːs/", type = "noun",
        breakdown = {letters = "p - ie - ce", sounds = "/p/ - /iː/ - /s/", tips = "ie为长元音/iː/"}},
    {en = "fry", cn = "油炒；油煎", phonetic = "/fraɪ/", type = "verb", thirdPerson = "fries",
        breakdown = {letters = "fr - y", sounds = "/fr/ - /aɪ/", tips = "y为双元音/aɪ/"}},
    {en = "finally", cn = "最后", phonetic = "/ˈfaɪnəli/", type = "adv",
        breakdown = {letters = "f - i - n - a - lly", sounds = "/f/ - /aɪ/ - /n/ - /ə/ - /li/", tips = "i为双元音/aɪ/"}},
    {en = "boil", cn = "煮沸", phonetic = "/bɔɪl/", type = "verb", thirdPerson = "boils",
        breakdown = {letters = "b - oi - l", sounds = "/b/ - /ɔɪ/ - /l/", tips = "oi为双元音/ɔɪ/"}},
    {en = "side", cn = "一边；侧面", phonetic = "/saɪd/", type = "noun",
        breakdown = {letters = "s - i - de", sounds = "/s/ - /aɪ/ - /d/", tips = "i_e为双元音/aɪ/"}},
    {en = "mutton", cn = "羊肉", phonetic = "/ˈmʌtn/", type = "noun",
        breakdown = {letters = "m - u - tt - on", sounds = "/m/ - /ʌ/ - /t/ - /n/", tips = "u为短元音/ʌ/"}},
    {en = "recipe", cn = "食谱", phonetic = "/ˈresəpi/", type = "noun",
        breakdown = {letters = "r - e - c - i - pe", sounds = "/r/ - /e/ - /s/ - /ə/ - /pi/", tips = "e为短元音/e/"}},
    {en = "beat", cn = "快速搅拌", phonetic = "/biːt/", type = "verb", thirdPerson = "beats",
        breakdown = {letters = "b - ea - t", sounds = "/b/ - /iː/ - /t/", tips = "ea为长元音/iː/"}},
    {en = "chopsticks", cn = "筷子", phonetic = "/ˈtʃɒpstɪks/", type = "noun",
        breakdown = {letters = "ch - o - p - st - i - cks", sounds = "/tʃ/ - /ɒ/ - /p/ - /st/ - /ɪ/ - /ks/", tips = "ch为破擦音/tʃ/，o为短元音/ɒ/"}},
    {en = "bowl", cn = "碗", phonetic = "/bəʊl/", type = "noun",
        breakdown = {letters = "b - ow - l", sounds = "/b/ - /əʊ/ - /l/", tips = "ow为双元音/əʊ/"}},
    {en = "menu", cn = "菜单", phonetic = "/ˈmenjuː/", type = "noun",
        breakdown = {letters = "m - e - n - u", sounds = "/m/ - /e/ - /n/ - /juː/", tips = "e为短元音/e/，u发/juː/"}},
}

-- Unit 4 词汇 (运动主题，含音标)
Vocabulary.unit4 = {
    {en = "date", cn = "日期；日子", phonetic = "/deɪt/", type = "noun",
        breakdown = {letters = "d - a - te", sounds = "/d/ - /eɪ/ - /t/", tips = "a_e为双元音/eɪ/"}},
    {en = "ground", cn = "场地；地面", phonetic = "/ɡraʊnd/", type = "noun",
        breakdown = {letters = "gr - ou - nd", sounds = "/ɡr/ - /aʊ/ - /nd/", tips = "ou为双元音/aʊ/"}},
    {en = "gym", cn = "健身房；体育馆", phonetic = "/dʒɪm/", type = "noun",
        breakdown = {letters = "g - y - m", sounds = "/dʒ/ - /ɪ/ - /m/", tips = "g发/dʒ/，y为短元音/ɪ/"}},
    {en = "team", cn = "队", phonetic = "/tiːm/", type = "noun",
        breakdown = {letters = "t - ea - m", sounds = "/t/ - /iː/ - /m/", tips = "ea为长元音/iː/"}},
    {en = "high", cn = "高的", phonetic = "/haɪ/", type = "adj",
        breakdown = {letters = "h - igh", sounds = "/h/ - /aɪ/", tips = "igh发双元音/aɪ/"}},
    {en = "rope", cn = "绳", phonetic = "/rəʊp/", type = "noun",
        breakdown = {letters = "r - o - pe", sounds = "/r/ - /əʊ/ - /p/", tips = "o_e为双元音/əʊ/"}},
    {en = "kick", cn = "踢", phonetic = "/kɪk/", type = "verb", thirdPerson = "kicks",
        breakdown = {letters = "k - i - ck", sounds = "/k/ - /ɪ/ - /k/", tips = "i为短元音/ɪ/"}},
    {en = "rock", cn = "岩石", phonetic = "/rɒk/", type = "noun",
        breakdown = {letters = "r - o - ck", sounds = "/r/ - /ɒ/ - /k/", tips = "o为短元音/ɒ/"}},
    {en = "climb", cn = "攀登；爬", phonetic = "/klaɪm/", type = "verb", thirdPerson = "climbs",
        breakdown = {letters = "cl - i - mb", sounds = "/kl/ - /aɪ/ - /m/", tips = "i为双元音/aɪ/，b不发音"}},
    {en = "active", cn = "活跃的", phonetic = "/ˈæktɪv/", type = "adj",
        breakdown = {letters = "a - ct - ive", sounds = "/æ/ - /kt/ - /ɪv/", tips = "a为短元音/æ/"}},
    {en = "part", cn = "部分", phonetic = "/pɑːt/", type = "noun",
        breakdown = {letters = "p - ar - t", sounds = "/p/ - /ɑː/ - /t/", tips = "ar为长元音/ɑː/"}},
    {en = "baseball", cn = "棒球运动", phonetic = "/ˈbeɪsbɔːl/", type = "noun",
        breakdown = {letters = "b - a - se - b - all", sounds = "/b/ - /eɪ/ - /s/ - /b/ - /ɔːl/", tips = "a_e为双元音/eɪ/，all发/ɔːl/"}},
    {en = "volleyball", cn = "排球", phonetic = "/ˈvɒlibɔːl/", type = "noun",
        breakdown = {letters = "v - o - ll - ey - b - all", sounds = "/v/ - /ɒ/ - /l/ - /i/ - /b/ - /ɔːl/", tips = "o为短元音/ɒ/"}},
    {en = "badminton", cn = "羽毛球运动", phonetic = "/ˈbædmɪntən/", type = "noun",
        breakdown = {letters = "b - a - d - m - in - ton", sounds = "/b/ - /æ/ - /d/ - /m/ - /ɪn/ - /tən/", tips = "a为短元音/æ/"}},
    {en = "tennis", cn = "网球", phonetic = "/ˈtenɪs/", type = "noun",
        breakdown = {letters = "t - e - nn - is", sounds = "/t/ - /e/ - /n/ - /ɪs/", tips = "e为短元音/e/"}},
    {en = "pull", cn = "拉；拔出", phonetic = "/pʊl/", type = "verb", thirdPerson = "pulls",
        breakdown = {letters = "p - u - ll", sounds = "/p/ - /ʊ/ - /l/", tips = "u为短元音/ʊ/"}},
    {en = "jog", cn = "慢跑", phonetic = "/dʒɒɡ/", type = "verb", thirdPerson = "jogs",
        breakdown = {letters = "j - o - g", sounds = "/dʒ/ - /ɒ/ - /ɡ/", tips = "o为短元音/ɒ/"}},
    {en = "safety", cn = "安全", phonetic = "/ˈseɪfti/", type = "noun",
        breakdown = {letters = "s - a - fe - ty", sounds = "/s/ - /eɪ/ - /f/ - /ti/", tips = "a_e为双元音/eɪ/"}},
    {en = "ankle", cn = "踝关节", phonetic = "/ˈæŋkl/", type = "noun",
        breakdown = {letters = "a - n - kle", sounds = "/æ/ - /ŋ/ - /kl/", tips = "a为短元音/æ/，n发鼻音/ŋ/"}},
    {en = "match", cn = "比赛", phonetic = "/mætʃ/", type = "noun", plural = "matches",
        breakdown = {letters = "m - a - tch", sounds = "/m/ - /æ/ - /tʃ/", tips = "a为短元音/æ/，tch发/tʃ/"}},
    {en = "gear", cn = "设备；用具", phonetic = "/ɡɪə(r)/", type = "noun",
        breakdown = {letters = "g - ear", sounds = "/ɡ/ - /ɪə/", tips = "ear为双元音/ɪə/"}},
    {en = "example", cn = "例子；实例", phonetic = "/ɪɡˈzɑːmpl/", type = "noun",
        breakdown = {letters = "ex - am - ple", sounds = "/ɪɡz/ - /ɑːm/ - /pl/", tips = "a为长元音/ɑː/"}},
    {en = "matter", cn = "问题；事情", phonetic = "/ˈmætə(r)/", type = "noun",


-- ============================================================================
-- 题目生成系统 - 根据难度生成不同类型的英语练习题 (增强版)
-- 每个知识专项独立生成500+题，支持音标显示
-- ============================================================================

local Vocabulary = require "vocabulary"

local QuestionGenerator = {}

-- 题目类型枚举
QuestionGenerator.TYPE = {
    TRANSLATE_CN_TO_EN = 1,
    TRANSLATE_EN_TO_CN = 2,
    ARTICLE_A_AN = 3,
    VERB_THIRD_PERSON = 4,
    PRONOUN_CASE = 5,
    NOUN_PLURAL = 6,
    FILL_BLANK = 7,
    SENTENCE_PATTERN = 8,
    WH_QUESTION = 9,
    PHONETIC_MATCH = 10,       -- 看音标选单词
    SPELLING_WITH_PHONETIC = 11, -- 看音标拼写
    WORD_TO_PHONETIC = 12,     -- 看单词选音标
}

-- 难度配置（综合挑战使用，包含所有专项）
QuestionGenerator.DIFFICULTY = {
    LOW = {
        name = "初级",
        totalQuestions = 50,
        types = {
            QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
            QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
            QuestionGenerator.TYPE.ARTICLE_A_AN,
            QuestionGenerator.TYPE.PHONETIC_MATCH,
            QuestionGenerator.TYPE.WORD_TO_PHONETIC,
        }
    },
    MEDIUM = {
        name = "中级",
        totalQuestions = 150,
        types = {
            QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
            QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
            QuestionGenerator.TYPE.ARTICLE_A_AN,
            QuestionGenerator.TYPE.VERB_THIRD_PERSON,
            QuestionGenerator.TYPE.PRONOUN_CASE,
            QuestionGenerator.TYPE.PHONETIC_MATCH,
            QuestionGenerator.TYPE.WORD_TO_PHONETIC,
            QuestionGenerator.TYPE.NOUN_PLURAL,
        }
    },
    HIGH = {
        name = "高级",
        totalQuestions = 350,
        types = {
            QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
            QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
            QuestionGenerator.TYPE.ARTICLE_A_AN,
            QuestionGenerator.TYPE.VERB_THIRD_PERSON,
            QuestionGenerator.TYPE.PRONOUN_CASE,
            QuestionGenerator.TYPE.NOUN_PLURAL,
            QuestionGenerator.TYPE.FILL_BLANK,
            QuestionGenerator.TYPE.SENTENCE_PATTERN,
            QuestionGenerator.TYPE.WH_QUESTION,
            QuestionGenerator.TYPE.PHONETIC_MATCH,
            QuestionGenerator.TYPE.WORD_TO_PHONETIC,
            QuestionGenerator.TYPE.SPELLING_WITH_PHONETIC,
        }
    }
}

-- ============================================================================
-- 音标类型和音形拆解系统
-- ============================================================================

-- 音标类型分类
local phoneticTypes = {
    -- 单元音 (短元音)
    ["ɪ"] = "短元音", ["e"] = "短元音", ["æ"] = "短元音", 
    ["ɒ"] = "短元音", ["ʊ"] = "短元音", ["ʌ"] = "短元音", ["ə"] = "短元音",
    -- 单元音 (长元音)
    ["iː"] = "长元音", ["ɑː"] = "长元音", ["ɔː"] = "长元音", 
    ["uː"] = "长元音", ["ɜː"] = "长元音",
    -- 双元音
    ["eɪ"] = "双元音", ["aɪ"] = "双元音", ["ɔɪ"] = "双元音",
    ["əʊ"] = "双元音", ["aʊ"] = "双元音", ["ɪə"] = "双元音", 
    ["eə"] = "双元音", ["ʊə"] = "双元音",
    -- 爆破音
    ["p"] = "爆破音", ["b"] = "爆破音", ["t"] = "爆破音", 
    ["d"] = "爆破音", ["k"] = "爆破音", ["g"] = "爆破音",
    -- 摩擦音
    ["f"] = "摩擦音", ["v"] = "摩擦音", ["θ"] = "摩擦音", 
    ["ð"] = "摩擦音", ["s"] = "摩擦音", ["z"] = "摩擦音", 
    ["ʃ"] = "摩擦音", ["ʒ"] = "摩擦音", ["h"] = "摩擦音",
    -- 破擦音
    ["tʃ"] = "破擦音", ["dʒ"] = "破擦音",
    -- 鼻音
    ["m"] = "鼻音", ["n"] = "鼻音", ["ŋ"] = "鼻音",
    -- 舌边音
    ["l"] = "舌边音",
    -- 半元音
    ["w"] = "半元音", ["j"] = "半元音",
    -- 颤音
    ["r"] = "颤音",
}

-- 常见字母组合到音标的映射（用于音形拆解）
local letterToPhonetic = {
    -- 元音字母组合
    ["ee"] = "/iː/ 长元音", ["ea"] = "/iː/ 长元音", 
    ["oo"] = "/uː/ 长元音", ["ou"] = "/aʊ/ 双元音", ["ow"] = "/aʊ/ 双元音",
    ["ai"] = "/eɪ/ 双元音", ["ay"] = "/eɪ/ 双元音",
    ["oi"] = "/ɔɪ/ 双元音", ["oy"] = "/ɔɪ/ 双元音",
    ["ar"] = "/ɑː/ 长元音", ["or"] = "/ɔː/ 长元音", ["er"] = "/ɜː/ 长元音",
    ["ir"] = "/ɜː/ 长元音", ["ur"] = "/ɜː/ 长元音",
    -- 辅音字母组合
    ["sh"] = "/ʃ/ 摩擦音", ["ch"] = "/tʃ/ 破擦音", ["th"] = "/θ/ 摩擦音",
    ["ng"] = "/ŋ/ 鼻音", ["ck"] = "/k/ 爆破音", ["ph"] = "/f/ 摩擦音",
    ["wh"] = "/w/ 半元音", ["wr"] = "/r/ 颤音", ["kn"] = "/n/ 鼻音",
    ["mb"] = "/m/ 鼻音", ["gh"] = "不发音",
}

-- 生成音形拆解说明
local function generatePhoneticBreakdown(word, phonetic)
    if not phonetic then return nil end
    
    -- 简化版：识别单词中的主要音素并给出类型说明
    local breakdown = {}
    local wordLower = string.lower(word)
    
    -- 检查常见字母组合
    for combo, desc in pairs(letterToPhonetic) do
        if string.find(wordLower, combo) then
            table.insert(breakdown, combo .. " → " .. desc)
        end
    end
    
    -- 如果没有找到组合，返回基本说明
    if #breakdown == 0 then
        return nil
    end
    
    return table.concat(breakdown, "\n")
end

-- 获取音标中主要元音的类型
local function getMainVowelType(phonetic)
    if not phonetic then return "元音" end
    
    -- 检查双元音（先检查，因为更长）
    local diphthongs = {"eɪ", "aɪ", "ɔɪ", "əʊ", "aʊ", "ɪə", "eə", "ʊə"}
    for _, d in ipairs(diphthongs) do
        if string.find(phonetic, d) then
            return "双元音 /" .. d .. "/"
        end
    end
    
    -- 检查长元音
    local longVowels = {"iː", "ɑː", "ɔː", "uː", "ɜː"}
    for _, v in ipairs(longVowels) do
        if string.find(phonetic, v) then
            return "长元音 /" .. v .. "/"
        end
    end
    
    -- 检查短元音
    local shortVowels = {"ɪ", "e", "æ", "ɒ", "ʊ", "ʌ", "ə"}
    for _, v in ipairs(shortVowels) do
        if string.find(phonetic, v) then
            return "短元音 /" .. v .. "/"
        end
    end
    
    return nil
end

-- 随机洗牌函数
local function shuffle(tbl)
    local result = {}
    for i, v in ipairs(tbl) do
        result[i] = v
    end
    for i = #result, 2, -1 do
        local j = math.random(1, i)
        result[i], result[j] = result[j], result[i]
    end
    return result
end

-- 随机选择 n 个不同元素
local function randomSelect(tbl, n, exclude)
    local available = {}
    for _, v in ipairs(tbl) do
        local shouldExclude = false
        if exclude then
            for _, ex in ipairs(exclude) do
                if v.en == ex.en then
                    shouldExclude = true
                    break
                end
            end
        end
        if not shouldExclude then
            table.insert(available, v)
        end
    end
    available = shuffle(available)
    local result = {}
    for i = 1, math.min(n, #available) do
        table.insert(result, available[i])
    end
    return result
end

-- 判断单词是否以元音开头
local function startsWithVowel(word)
    local lower = string.lower(word)
    local firstChar = string.sub(lower, 1, 1)
    
    for _, w in ipairs(Vocabulary.articleRules.exceptions.a) do
        if string.lower(w) == lower then return false end
    end
    for _, w in ipairs(Vocabulary.articleRules.exceptions.an) do
        if string.lower(w) == lower then return true end
    end
    
    for _, vowel in ipairs(Vocabulary.articleRules.vowelSounds) do
        if firstChar == vowel then return true end
    end
    return false
end

-- 生成填空显示（带下划线标记）
local function generateFillBlankDisplay(word, hideRatio)
    hideRatio = hideRatio or 0.5
    local en = word.en
    local display = ""
    local underlines = ""
    local hideCount = math.max(1, math.floor(#en * hideRatio))
    local hidePositions = {}
    
    -- 随机选择要隐藏的位置
    local positions = {}
    for i = 1, #en do
        table.insert(positions, i)
    end
    positions = shuffle(positions)
    for i = 1, hideCount do
        hidePositions[positions[i]] = true
    end
    
    -- 生成显示字符串和下划线
    for i = 1, #en do
        local char = string.sub(en, i, i)
        if hidePositions[i] then
            display = display .. "_"
            underlines = underlines .. "‾"  -- 上划线用于显示
        else
            display = display .. char
            underlines = underlines .. " "
        end
    end
    
    return display, underlines
end

-- 生成音标对应显示
local function generatePhoneticDisplay(word)
    if not word.phonetic then return nil end
    
    local phonetic = word.phonetic
    local en = word.en
    
    -- 返回单词和音标用于分行显示
    return {
        word = en,
        phonetic = phonetic
    }
end

-- 生成动词三单形式
local function getThirdPerson(verb)
    if verb.thirdPerson then
        return verb.thirdPerson
    end
    
    local word = verb.en
    local lastChar = string.sub(word, -1)
    local lastTwo = string.sub(word, -2)
    
    if lastChar == "s" or lastChar == "x" or lastChar == "o" or
       lastTwo == "ch" or lastTwo == "sh" then
        return word .. "es"
    end
    
    if lastChar == "y" then
        local secondLast = string.sub(word, -2, -2)
        local vowels = {a=1, e=1, i=1, o=1, u=1}
        if not vowels[secondLast] then
            return string.sub(word, 1, -2) .. "ies"
        end
    end
    
    return word .. "s"
end

-- 生成名词复数形式
local function getPlural(noun)
    if noun.plural then
        return noun.plural
    end
    
    local word = noun.en
    local lastChar = string.sub(word, -1)
    local lastTwo = string.sub(word, -2)
    
    if lastChar == "s" or lastChar == "x" or
       lastTwo == "ch" or lastTwo == "sh" then
        return word .. "es"
    end
    
    if lastChar == "y" then
        local secondLast = string.sub(word, -2, -2)
        local vowels = {a=1, e=1, i=1, o=1, u=1}
        if not vowels[secondLast] then
            return string.sub(word, 1, -2) .. "ies"
        end
    end
    
    if lastTwo == "fe" then
        return string.sub(word, 1, -3) .. "ves"
    end
    if lastChar == "f" then
        return string.sub(word, 1, -2) .. "ves"
    end
    
    return word .. "s"
end

-- 句型模板（扩展版本）
local sentencePatterns = {
    {pattern = "SV", cn = "主谓结构", examples = {
        {subject = "The bell", verb = "is ringing", cn = "铃声响了"},
        {subject = "Birds", verb = "sing", cn = "鸟儿唱歌"},
        {subject = "Time", verb = "flies", cn = "时间飞逝"},
        {subject = "The sun", verb = "rises", cn = "太阳升起"},
        {subject = "Children", verb = "play", cn = "孩子们玩耍"},
        {subject = "Dogs", verb = "bark", cn = "狗在叫"},
        {subject = "Fish", verb = "swim", cn = "鱼在游"},
        {subject = "Leaves", verb = "fall", cn = "树叶飘落"},
    }},
    {pattern = "SVC", cn = "主系表结构", examples = {
        {subject = "Lu Yao", linking_verb = "looks", complement = "happy", cn = "路遥看起来很高兴"},
        {subject = "The soup", linking_verb = "tastes", complement = "delicious", cn = "汤尝起来很美味"},
        {subject = "She", linking_verb = "is", complement = "a teacher", cn = "她是一名老师"},
        {subject = "The flower", linking_verb = "smells", complement = "sweet", cn = "花闻起来很香"},
        {subject = "He", linking_verb = "becomes", complement = "famous", cn = "他变得出名了"},
        {subject = "The music", linking_verb = "sounds", complement = "beautiful", cn = "音乐听起来很美"},
        {subject = "I", linking_verb = "feel", complement = "tired", cn = "我感觉累了"},
        {subject = "The cake", linking_verb = "looks", complement = "yummy", cn = "蛋糕看起来很好吃"},
    }},
    {pattern = "SVO", cn = "主谓宾结构", examples = {
        {subject = "Lin Dong", verb = "loves", object = "sports", cn = "林东热爱运动"},
        {subject = "I", verb = "like", object = "music", cn = "我喜欢音乐"},
        {subject = "She", verb = "teaches", object = "English", cn = "她教英语"},
        {subject = "They", verb = "play", object = "basketball", cn = "他们打篮球"},
        {subject = "We", verb = "eat", object = "breakfast", cn = "我们吃早餐"},
        {subject = "He", verb = "reads", object = "books", cn = "他读书"},
        {subject = "Tom", verb = "watches", object = "TV", cn = "汤姆看电视"},
        {subject = "Mary", verb = "drinks", object = "milk", cn = "玛丽喝牛奶"},
    }},
}

-- Wh- 疑问词（扩展版本）
local whQuestionTemplates = {
    {wh = "What", templates = {
        {q = "____ is your name?", cn = "询问事物"},
        {q = "____ do you want?", cn = "询问事物"},
        {q = "____ time is it?", cn = "询问时间"},
        {q = "____ color do you like?", cn = "询问事物"},
        {q = "____ are you doing?", cn = "询问事物"},
    }},
    {wh = "Who", templates = {
        {q = "____ is your teacher?", cn = "询问人"},
        {q = "____ are they?", cn = "询问人"},
        {q = "____ can help me?", cn = "询问人"},
        {q = "____ is calling?", cn = "询问人"},
    }},
    {wh = "Where", templates = {
        {q = "____ do you live?", cn = "询问地点"},
        {q = "____ is my book?", cn = "询问地点"},
        {q = "____ are you going?", cn = "询问地点"},
        {q = "____ is the library?", cn = "询问地点"},
    }},
    {wh = "When", templates = {
        {q = "____ is your birthday?", cn = "询问时间"},
        {q = "____ do you get up?", cn = "询问时间"},
        {q = "____ will you come back?", cn = "询问时间"},
        {q = "____ does the class start?", cn = "询问时间"},
    }},
    {wh = "Why", templates = {
        {q = "____ are you late?", cn = "询问原因"},
        {q = "____ do you like it?", cn = "询问原因"},
        {q = "____ is she crying?", cn = "询问原因"},
        {q = "____ did you do that?", cn = "询问原因"},
    }},
    {wh = "How", templates = {
        {q = "____ do you go to school?", cn = "询问方式"},
        {q = "____ are you today?", cn = "询问状态"},
        {q = "____ old are you?", cn = "询问年龄"},
        {q = "____ much is it?", cn = "询问价格"},
        {q = "____ many apples do you have?", cn = "询问数量"},
    }},
    {wh = "Which", templates = {
        {q = "____ book do you like?", cn = "询问选择"},
        {q = "____ one is yours?", cn = "询问选择"},
        {q = "____ color do you prefer?", cn = "询问选择"},
    }},
    {wh = "Whose", templates = {
        {q = "____ pen is this?", cn = "询问所属"},
        {q = "____ bag is that?", cn = "询问所属"},
        {q = "____ turn is it?", cn = "询问所属"},
    }},
}

-- ============================================================================
-- 题目生成函数
-- ============================================================================

-- 生成中文选英文题
function QuestionGenerator.generateTranslateCnToEn(words, variation)
    variation = variation or math.random(1, 3)
    local word = words[math.random(1, #words)]
    local options = randomSelect(words, 3, {word})
    table.insert(options, word)
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt.en == word.en then
            correctIndex = i
            break
        end
    end
    
    local questionText = ""
    if variation == 1 then
        questionText = "选择正确的英文翻译：" .. word.cn
    elseif variation == 2 then
        questionText = '"' .. word.cn .. '" 的英文是？'
    else
        questionText = "哪个单词表示 \"" .. word.cn .. "\" ？"
    end
    
    return {
        type = QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN,
        question = questionText,
        options = {options[1].en, options[2].en, options[3].en, options[4].en},
        correctAnswer = correctIndex,
        word = word,
        showPhonetic = true,
        explanation = '正确答案：' .. word.en .. '\n"' .. word.cn .. '" 的英文是 "' .. word.en .. '" ' .. (word.phonetic or "")
    }
end

-- 生成英文选中文题
function QuestionGenerator.generateTranslateEnToCn(words, variation)
    variation = variation or math.random(1, 3)
    local word = words[math.random(1, #words)]
    local options = randomSelect(words, 3, {word})
    table.insert(options, word)
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt.cn == word.cn then
            correctIndex = i
            break
        end
    end
    
    local questionText = ""
    if variation == 1 then
        questionText = "选择正确的中文翻译：" .. word.en
    elseif variation == 2 then
        questionText = '"' .. word.en .. '" 的意思是？'
    else
        questionText = "单词 \"" .. word.en .. "\" 表示什么？"
    end
    
    return {
        type = QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN,
        question = questionText,
        questionPhonetic = word.phonetic,
        options = {options[1].cn, options[2].cn, options[3].cn, options[4].cn},
        correctAnswer = correctIndex,
        word = word,
        showPhonetic = true,
        explanation = '正确答案：' .. word.cn .. '\n"' .. word.en .. '" ' .. (word.phonetic or "") .. ' 的中文意思是 "' .. word.cn .. '"'
    }
end

-- 生成 a/an 选择题
function QuestionGenerator.generateArticleQuestion(words, variation)
    local nouns = {}
    for _, w in ipairs(words) do
        if w.type == "noun" then
            table.insert(nouns, w)
        end
    end
    if #nouns == 0 then nouns = words end
    
    local word = nouns[math.random(1, #nouns)]
    local isVowel = startsWithVowel(word.en)
    
    local templates = {
        "选择正确的冠词：____ " .. word.en,
        "填入正确的不定冠词：____ " .. word.en,
        "This is ____ " .. word.en .. ". 选择正确答案：",
        "I have ____ " .. word.en .. ". 填入：",
    }
    
    local correctArticle = isVowel and "an" or "a"
    local explanation = '正确答案：' .. correctArticle .. '\n解析：' .. (isVowel and 'an 用于元音音素开头的词前' or 'a 用于辅音音素开头的词前')
    
    return {
        type = QuestionGenerator.TYPE.ARTICLE_A_AN,
        question = templates[math.random(1, #templates)],
        questionPhonetic = word.phonetic,
        options = {"a", "an"},
        correctAnswer = isVowel and 2 or 1,
        word = word,
        showPhonetic = true,
        explanation = explanation
    }
end

-- 生成动词三单变形题（扩展）
function QuestionGenerator.generateVerbThirdPerson(words, variation)
    local verbs = {}
    for _, w in ipairs(words) do
        if w.type == "verb" then
            table.insert(verbs, w)
        end
    end
    if #verbs == 0 then
        verbs = Vocabulary.getVerbs()
    end
    
    local verb = verbs[math.random(1, #verbs)]
    local correct = getThirdPerson(verb)
    
    -- 生成干扰项
    local wrongOptions = {
        verb.en .. "s",
        verb.en .. "es",
        verb.en .. "ies",
        verb.en,
    }
    
    local options = {correct}
    for _, opt in ipairs(wrongOptions) do
        if opt ~= correct and #options < 4 then
            local dup = false
            for _, existing in ipairs(options) do
                if existing == opt then dup = true break end
            end
            if not dup then
                table.insert(options, opt)
            end
        end
    end
    while #options < 4 do
        table.insert(options, verb.en .. "s")
    end
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt == correct then
            correctIndex = i
            break
        end
    end
    
    -- 不同句型模板
    local templates = {
        "He ____ (" .. verb.en .. ") every day.",
        "She ____ (" .. verb.en .. ") in the morning.",
        "My father ____ (" .. verb.en .. ") at home.",
        "The boy ____ (" .. verb.en .. ") happily.",
        "Tom ____ (" .. verb.en .. ") after school.",
    }
    
    local rule = "一般动词直接加 s"
    local lastChar = string.sub(verb.en, -1)
    local lastTwo = string.sub(verb.en, -2)
    if lastChar == "s" or lastChar == "x" or lastChar == "o" or
       lastTwo == "ch" or lastTwo == "sh" then
        rule = "以 s/x/ch/sh/o 结尾的动词加 es"
    elseif lastChar == "y" then
        local secondLast = string.sub(verb.en, -2, -2)
        local vowels = {a=1, e=1, i=1, o=1, u=1}
        if not vowels[secondLast] then
            rule = "以辅音字母+y 结尾，变 y 为 i 再加 es"
        end
    end
    
    return {
        type = QuestionGenerator.TYPE.VERB_THIRD_PERSON,
        question = templates[math.random(1, #templates)] .. "\n填入动词的正确形式：",
        options = options,
        correctAnswer = correctIndex,
        word = verb,
        showPhonetic = true,
        explanation = "正确答案：" .. correct .. "\n解析：" .. rule
    }
end

-- 生成人称代词主宾格题（扩展）
function QuestionGenerator.generatePronounCase(variation)
    local pronouns = Vocabulary.pronouns
    local pronoun = pronouns[math.random(1, #pronouns)]
    
    local isSubject = math.random(1, 2) == 1
    
    local subjectTemplates = {
        {q = "____ am a student.", answer = "I", hint = "第一人称单数主格"},
        {q = "____ is my friend.", answer = "He", hint = "第三人称单数男性主格"},
        {q = "____ is my sister.", answer = "She", hint = "第三人称单数女性主格"},
        {q = "____ are my classmates.", answer = "They", hint = "第三人称复数主格"},
        {q = "____ are going to school.", answer = "We", hint = "第一人称复数主格"},
        {q = "____ is a cat.", answer = "It", hint = "第三人称单数中性主格"},
        {q = "____ are a good student.", answer = "You", hint = "第二人称主格"},
        {q = "____ likes music.", answer = "He", hint = "第三人称单数男性主格"},
        {q = "____ love sports.", answer = "They", hint = "第三人称复数主格"},
    }
    
    local objectTemplates = {
        {q = "Please give it to ____.", answer = "me", hint = "第一人称单数宾格"},
        {q = "Can you help ____?", answer = "me", hint = "第一人称单数宾格"},
        {q = "I will call ____ later.", answer = "him", hint = "第三人称单数男性宾格"},
        {q = "She told ____ the news.", answer = "us", hint = "第一人称复数宾格"},
        {q = "Look at ____!", answer = "them", hint = "第三人称复数宾格"},
        {q = "I like ____ very much.", answer = "her", hint = "第三人称单数女性宾格"},
        {q = "Give ____ some water.", answer = "it", hint = "第三人称单数中性宾格"},
        {q = "Come with ____.", answer = "us", hint = "第一人称复数宾格"},
    }
    
    local templates = isSubject and subjectTemplates or objectTemplates
    local template = templates[math.random(1, #templates)]
    
    local options = {}
    if isSubject then
        for _, p in ipairs(pronouns) do
            if #options < 4 then
                table.insert(options, p.subject)
            end
        end
    else
        for _, p in ipairs(pronouns) do
            if #options < 4 then
                table.insert(options, p.object)
            end
        end
    end
    options = shuffle(options)
    
    local found = false
    for i, opt in ipairs(options) do
        if opt == template.answer then
            found = true
            break
        end
    end
    if not found then
        options[1] = template.answer
        options = shuffle(options)
    end
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt == template.answer then
            correctIndex = i
            break
        end
    end
    
    local tip = isSubject 
        and "【提示】主格代词用在动词前作主语"
        or "【提示】宾格代词用在动词/介词后作宾语"
    
    return {
        type = QuestionGenerator.TYPE.PRONOUN_CASE,
        question = "选择正确的代词：\n" .. template.q,
        options = options,
        correctAnswer = correctIndex,
        explanation = "正确答案：" .. template.answer .. "\n解析：" .. (isSubject and "主格代词用在动词前作主语" or "宾格代词用在动词/介词后作宾语")
    }
end

-- 生成名词复数题（扩展）
function QuestionGenerator.generateNounPlural(words, variation)
    local nouns = {}
    for _, w in ipairs(words) do
        if w.type == "noun" and w.plural then
            table.insert(nouns, w)
        end
    end
    
    if #nouns < 4 then
        for _, irregular in ipairs(Vocabulary.irregularPlurals) do
            table.insert(nouns, {en = irregular.singular, plural = irregular.plural, rule = irregular.rule, phonetic = irregular.phonetic})
        end
    end
    
    local noun = nouns[math.random(1, #nouns)]
    local correct = noun.plural or getPlural(noun)
    
    local wrongOptions = {}
    table.insert(wrongOptions, noun.en .. "s")
    table.insert(wrongOptions, noun.en .. "es")
    if string.sub(noun.en, -1) == "y" then
        table.insert(wrongOptions, string.sub(noun.en, 1, -2) .. "ies")
    end
    if string.sub(noun.en, -1) == "f" then
        table.insert(wrongOptions, string.sub(noun.en, 1, -2) .. "ves")
    end
    table.insert(wrongOptions, noun.en)
    
    local options = {correct}
    for _, opt in ipairs(wrongOptions) do
        if opt ~= correct and #options < 4 then
            local dup = false
            for _, existing in ipairs(options) do
                if existing == opt then dup = true break end
            end
            if not dup then
                table.insert(options, opt)
            end
        end
    end
    while #options < 4 do
        table.insert(options, noun.en .. "s")
    end
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt == correct then
            correctIndex = i
            break
        end
    end
    
    local templates = {
        '选择名词 "' .. noun.en .. '" 的正确复数形式：',
        '"' .. noun.en .. '" 的复数是什么？',
        '把 "' .. noun.en .. '" 变成复数形式：',
        'I have two ____. (' .. noun.en .. ')',
    }
    
    local rule = noun.rule or "一般名词直接加 s"
    
    return {
        type = QuestionGenerator.TYPE.NOUN_PLURAL,
        question = templates[math.random(1, #templates)],
        questionPhonetic = noun.phonetic,
        options = options,
        correctAnswer = correctIndex,
        word = noun,
        showPhonetic = true,
        explanation = "正确答案：" .. correct .. "\n解析：" .. rule
    }
end

-- 生成拼写填空题（带音标和下划线）
function QuestionGenerator.generateFillBlankQuestion(words, variation)
    local word = words[math.random(1, #words)]
    local hideRatio = variation == 1 and 0.3 or (variation == 2 and 0.5 or 0.7)
    local display, underlines = generateFillBlankDisplay(word, hideRatio)
    
    return {
        type = QuestionGenerator.TYPE.FILL_BLANK,
        question = "根据中文提示和音标，完成单词拼写：",
        fillBlankDisplay = display,
        fillBlankUnderlines = underlines,
        chineseHint = word.cn,
        phoneticHint = word.phonetic,
        options = nil,
        correctAnswer = word.en,
        word = word,
        isTextInput = true,
        showPhonetic = true,
        explanation = "正确答案：" .. word.en .. "\n" .. (word.phonetic or "") .. "\n中文：" .. word.cn
    }
end

-- 生成句型识别题
function QuestionGenerator.generateSentencePatternQuestion(variation)
    local pattern = sentencePatterns[math.random(1, #sentencePatterns)]
    local example = pattern.examples[math.random(1, #pattern.examples)]
    
    local sentence = ""
    if pattern.pattern == "SV" then
        sentence = example.subject .. " " .. example.verb .. "."
    elseif pattern.pattern == "SVC" then
        sentence = example.subject .. " " .. example.linking_verb .. " " .. example.complement .. "."
    elseif pattern.pattern == "SVO" then
        sentence = example.subject .. " " .. example.verb .. " " .. example.object .. "."
    end
    
    local options = {"SV (主谓)", "SVC (主系表)", "SVO (主谓宾)", "SVOO (主谓双宾)"}
    local correctIndex = 1
    if pattern.pattern == "SV" then correctIndex = 1
    elseif pattern.pattern == "SVC" then correctIndex = 2
    elseif pattern.pattern == "SVO" then correctIndex = 3
    end
    
    -- 生成详细的成分分析解析
    local explanation = "正确答案：" .. pattern.pattern .. " (" .. pattern.cn .. ")\n"
    
    if pattern.pattern == "SV" then
        explanation = explanation .. "成分分析：\n"
        explanation = explanation .. "  • " .. example.subject .. " → 主语(S)\n"
        explanation = explanation .. "  • " .. example.verb .. " → 谓语动词(V)\n"
        explanation = explanation .. "解析：主谓结构只有主语和谓语，表示\"谁做什么\""
    elseif pattern.pattern == "SVC" then
        explanation = explanation .. "成分分析：\n"
        explanation = explanation .. "  • " .. example.subject .. " → 主语(S)\n"
        explanation = explanation .. "  • " .. example.linking_verb .. " → 系动词(V)\n"
        explanation = explanation .. "  • " .. example.complement .. " → 表语(C)\n"
        explanation = explanation .. "解析：系动词(is/look/feel等)后接表语，描述主语的状态"
    elseif pattern.pattern == "SVO" then
        explanation = explanation .. "成分分析：\n"
        explanation = explanation .. "  • " .. example.subject .. " → 主语(S)\n"
        explanation = explanation .. "  • " .. example.verb .. " → 谓语动词(V)\n"
        explanation = explanation .. "  • " .. example.object .. " → 宾语(O)\n"
        explanation = explanation .. "解析：主谓宾结构表示\"谁对什么做了什么\""
    end
    
    return {
        type = QuestionGenerator.TYPE.SENTENCE_PATTERN,
        question = "判断下列句子的句型结构：\n\"" .. sentence .. "\"",
        options = options,
        correctAnswer = correctIndex,
        showPuzzle = true,
        puzzlePattern = pattern.pattern,
        explanation = explanation
    }
end

-- 生成 Wh- 疑问句题
function QuestionGenerator.generateWhQuestion(variation)
    local whGroup = whQuestionTemplates[math.random(1, #whQuestionTemplates)]
    local template = whGroup.templates[math.random(1, #whGroup.templates)]
    
    local options = {}
    for _, wg in ipairs(whQuestionTemplates) do
        table.insert(options, wg.wh)
        if #options >= 4 then break end
    end
    options = shuffle(options)
    
    local found = false
    for i, opt in ipairs(options) do
        if opt == whGroup.wh then
            found = true
            break
        end
    end
    if not found then
        options[1] = whGroup.wh
        options = shuffle(options)
    end
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt == whGroup.wh then
            correctIndex = i
            break
        end
    end
    
    return {
        type = QuestionGenerator.TYPE.WH_QUESTION,
        question = "选择正确的疑问词：\n" .. template.q,
        options = options,
        correctAnswer = correctIndex,
        explanation = "正确答案：" .. whGroup.wh .. "\n解析：" .. whGroup.wh .. " 一般用于" .. template.cn
    }
end

-- 生成音标匹配题
function QuestionGenerator.generatePhoneticMatch(words, variation)
    local wordsWithPhonetic = {}
    for _, w in ipairs(words) do
        if w.phonetic then
            table.insert(wordsWithPhonetic, w)
        end
    end
    if #wordsWithPhonetic < 4 then return nil end
    
    local word = wordsWithPhonetic[math.random(1, #wordsWithPhonetic)]
    local options = randomSelect(wordsWithPhonetic, 3, {word})
    table.insert(options, word)
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt.en == word.en then
            correctIndex = i
            break
        end
    end
    
    local templates = {
        "音标 " .. word.phonetic .. " 对应哪个单词？",
        "选择与音标 " .. word.phonetic .. " 匹配的单词：",
        "哪个单词的读音是 " .. word.phonetic .. " ？",
    }
    
    return {
        type = QuestionGenerator.TYPE.PHONETIC_MATCH,
        question = templates[math.random(1, #templates)],
        options = {options[1].en, options[2].en, options[3].en, options[4].en},
        correctAnswer = correctIndex,
        word = word,
        showPhonetic = true,
        explanation = (function()
            local parts = {"正确答案：" .. word.en}
            -- 优先使用词汇表中的拆解数据
            if word.breakdown then
                table.insert(parts, "音形拆解：")
                table.insert(parts, "  " .. word.breakdown.letters)
                table.insert(parts, "  " .. word.breakdown.sounds)
                table.insert(parts, "解析：" .. word.breakdown.tips)
            else
                -- 备用：自动生成的解析
                local vowelType = getMainVowelType(word.phonetic)
                if vowelType then
                    table.insert(parts, "解析：主要元音为" .. vowelType)
                end
            end
            return table.concat(parts, "\n")
        end)()
    }
end

-- 生成看音标拼写题
function QuestionGenerator.generateSpellingWithPhonetic(words, variation)
    local wordsWithPhonetic = {}
    for _, w in ipairs(words) do
        if w.phonetic and #w.en <= 8 then
            table.insert(wordsWithPhonetic, w)
        end
    end
    if #wordsWithPhonetic == 0 then return nil end
    
    local word = wordsWithPhonetic[math.random(1, #wordsWithPhonetic)]
    
    return {
        type = QuestionGenerator.TYPE.SPELLING_WITH_PHONETIC,
        question = "根据音标写出单词：",
        phoneticDisplay = word.phonetic,
        chineseHint = word.cn,
        options = nil,
        correctAnswer = word.en,
        word = word,
        isTextInput = true,
        showPhonetic = true,
        explanation = (function()
            local parts = {"正确答案：" .. word.en}
            if word.breakdown then
                table.insert(parts, "音形拆解：")
                table.insert(parts, "  " .. word.breakdown.letters)
                table.insert(parts, "  " .. word.breakdown.sounds)
                table.insert(parts, "解析：" .. word.breakdown.tips)
            else
                local vowelType = getMainVowelType(word.phonetic)
                if vowelType then
                    table.insert(parts, "解析：主要元音为" .. vowelType)
                end
            end
            return table.concat(parts, "\n")
        end)()
    }
end

-- 生成看单词选音标题
function QuestionGenerator.generateWordToPhonetic(words, variation)
    local wordsWithPhonetic = {}
    for _, w in ipairs(words) do
        if w.phonetic then
            table.insert(wordsWithPhonetic, w)
        end
    end
    if #wordsWithPhonetic < 4 then return nil end
    
    local word = wordsWithPhonetic[math.random(1, #wordsWithPhonetic)]
    local options = randomSelect(wordsWithPhonetic, 3, {word})
    table.insert(options, word)
    options = shuffle(options)
    
    local correctIndex = 1
    for i, opt in ipairs(options) do
        if opt.en == word.en then
            correctIndex = i
            break
        end
    end
    
    local templates = {
        '单词 "' .. word.en .. '" 的音标是？',
        '选择 "' .. word.en .. '" 的正确读音：',
        '"' .. word.en .. '" 怎么读？选择正确的音标：',
    }
    
    return {
        type = QuestionGenerator.TYPE.WORD_TO_PHONETIC,
        question = templates[math.random(1, #templates)],
        wordDisplay = word.en,
        chineseHint = word.cn,
        options = {options[1].phonetic, options[2].phonetic, options[3].phonetic, options[4].phonetic},
        correctAnswer = correctIndex,
        word = word,
        showPhonetic = false,
        explanation = (function()
            local parts = {"正确答案：" .. word.phonetic}
            if word.breakdown then
                table.insert(parts, "音形拆解：")
                table.insert(parts, "  " .. word.breakdown.letters)
                table.insert(parts, "  " .. word.breakdown.sounds)
                table.insert(parts, "解析：" .. word.breakdown.tips)
            else
                local vowelType = getMainVowelType(word.phonetic)
                if vowelType then
                    table.insert(parts, "解析：主要元音为" .. vowelType)
                end
            end
            return table.concat(parts, "\n")
        end)()
    }
end

-- ============================================================================
-- 知识专项配置（每个专项独立题库）
-- ============================================================================

QuestionGenerator.CATEGORIES = {
    {
        id = "vocabulary",
        name = "词汇翻译",
        description = "单词中英互译练习",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            local words = Vocabulary.getAllWords()
            for i = 1, count do
                local variation = (i % 3) + 1
                local q
                if i % 2 == 0 then
                    q = QuestionGenerator.generateTranslateCnToEn(words, variation)
                else
                    q = QuestionGenerator.generateTranslateEnToCn(words, variation)
                end
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "article",
        name = "冠词 a/an",
        description = "不定冠词用法练习",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            local words = Vocabulary.getAllWords()
            for i = 1, count do
                local q = QuestionGenerator.generateArticleQuestion(words, (i % 4) + 1)
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "verb",
        name = "动词三单",
        description = "动词第三人称单数变化",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            local words = Vocabulary.getAllWords()
            for i = 1, count do
                local q = QuestionGenerator.generateVerbThirdPerson(words, (i % 5) + 1)
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "pronoun",
        name = "人称代词",
        description = "主格与宾格转换",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            for i = 1, count do
                local q = QuestionGenerator.generatePronounCase((i % 2) + 1)
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "plural",
        name = "名词复数",
        description = "名词单复数变化规则",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            local words = Vocabulary.getAllWords()
            for i = 1, count do
                local q = QuestionGenerator.generateNounPlural(words, (i % 4) + 1)
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "sentence",
        name = "句型结构",
        description = "SV/SVC/SVO 句型识别",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            for i = 1, count do
                local q = QuestionGenerator.generateSentencePatternQuestion((i % 3) + 1)
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "wh_question",
        name = "特殊疑问句",
        description = "Wh- 疑问词用法",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            for i = 1, count do
                local q = QuestionGenerator.generateWhQuestion((i % 8) + 1)
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
    {
        id = "phonetic",
        name = "音标练习",
        description = "音标识别与匹配",
        questionCount = 100,
        generator = function(count)
            local questions = {}
            local words = Vocabulary.getAllWords()
            for i = 1, count do
                local q
                -- 交替生成两种音标题型：看音标选单词、看单词选音标
                if i % 2 == 0 then
                    q = QuestionGenerator.generatePhoneticMatch(words, (i % 3) + 1)
                else
                    q = QuestionGenerator.generateWordToPhonetic(words, (i % 3) + 1)
                end
                if q then
                    q.id = i
                    table.insert(questions, q)
                end
            end
            return questions
        end
    },
}

-- 根据知识专项生成题目
function QuestionGenerator.generateCategoryQuestions(categoryId, count)
    local category = nil
    for _, cat in ipairs(QuestionGenerator.CATEGORIES) do
        if cat.id == categoryId then
            category = cat
            break
        end
    end
    
    if category and category.generator then
        return category.generator(count or category.questionCount)
    end
    
    return QuestionGenerator.generateQuestionSet("MEDIUM", count)
end

-- 根据难度生成题目集
function QuestionGenerator.generateQuestionSet(difficulty, count)
    local config = QuestionGenerator.DIFFICULTY[difficulty]
    if not config then
        config = QuestionGenerator.DIFFICULTY.MEDIUM
    end
    
    local questions = {}
    local words = Vocabulary.getAllWords()
    local actualCount = count or config.totalQuestions
    
    for i = 1, actualCount do
        local typeIndex = ((i - 1) % #config.types) + 1
        local qType = config.types[typeIndex]
        local question = nil
        local variation = (i % 5) + 1
        
        if qType == QuestionGenerator.TYPE.TRANSLATE_CN_TO_EN then
            question = QuestionGenerator.generateTranslateCnToEn(words, variation)
        elseif qType == QuestionGenerator.TYPE.TRANSLATE_EN_TO_CN then
            question = QuestionGenerator.generateTranslateEnToCn(words, variation)
        elseif qType == QuestionGenerator.TYPE.ARTICLE_A_AN then
            question = QuestionGenerator.generateArticleQuestion(words, variation)
        elseif qType == QuestionGenerator.TYPE.VERB_THIRD_PERSON then
            question = QuestionGenerator.generateVerbThirdPerson(words, variation)
        elseif qType == QuestionGenerator.TYPE.PRONOUN_CASE then
            question = QuestionGenerator.generatePronounCase(variation)
        elseif qType == QuestionGenerator.TYPE.NOUN_PLURAL then
            question = QuestionGenerator.generateNounPlural(words, variation)
        elseif qType == QuestionGenerator.TYPE.FILL_BLANK then
            question = QuestionGenerator.generateFillBlankQuestion(words, variation)
        elseif qType == QuestionGenerator.TYPE.SENTENCE_PATTERN then
            question = QuestionGenerator.generateSentencePatternQuestion(variation)
        elseif qType == QuestionGenerator.TYPE.WH_QUESTION then
            question = QuestionGenerator.generateWhQuestion(variation)
        elseif qType == QuestionGenerator.TYPE.PHONETIC_MATCH then
            question = QuestionGenerator.generatePhoneticMatch(words, variation)
        elseif qType == QuestionGenerator.TYPE.SPELLING_WITH_PHONETIC then
            question = QuestionGenerator.generateSpellingWithPhonetic(words, variation)
        elseif qType == QuestionGenerator.TYPE.WORD_TO_PHONETIC then
            question = QuestionGenerator.generateWordToPhonetic(words, variation)
        end
        
        if question then
            question.id = i
            table.insert(questions, question)
        end
    end
    
    return questions
end

return QuestionGenerator

以下是音标识别与拆解系统的完整实现：

音标系统完整代码
1. 词汇数据结构 (vocabulary.lua)
每个单词可以包含一个 breakdown 字段，用于手动定义音形拆解：

lua

复制
{
    en = "start",           -- 英文
    cn = "开始",            -- 中文
    phonetic = "/stɑːt/",   -- 音标
    type = "verb",          -- 词性
    thirdPerson = "starts", -- 三单形式（动词特有）
    breakdown = {           -- 音形拆解（核心数据）
        letters = "st - ar - t",        -- 字母拆分
        sounds = "/st/ - /ɑː/ - /t/",   -- 对应音素
        tips = "ar为长元音/ɑː/"          -- 规则提示
    }
}
示例数据：

lua

复制
-- Unit 1 词汇示例
{en = "life", cn = "生活；生命", phonetic = "/laɪf/", type = "noun", plural = "lives",
    breakdown = {letters = "l - i - fe", sounds = "/l/ - /aɪ/ - /f/", tips = "i为双元音/aɪ/"}},

{en = "break", cn = "课间休息", phonetic = "/breɪk/", type = "noun",
    breakdown = {letters = "br - ea - k", sounds = "/br/ - /eɪ/ - /k/", tips = "ea为双元音/eɪ/"}},

{en = "join", cn = "加入", phonetic = "/dʒɔɪn/", type = "verb", thirdPerson = "joins",
    breakdown = {letters = "j - oi - n", sounds = "/dʒ/ - /ɔɪ/ - /n/", tips = "oi为双元音/ɔɪ/"}},

{en = "noon", cn = "正午", phonetic = "/nuːn/", type = "noun",
    breakdown = {letters = "n - oo - n", sounds = "/n/ - /uː/ - /n/", tips = "oo为长元音/uː/"}},
2. 音标分类系统 (question_generator.lua)
lua

复制
-- 音标类型分类表
local phoneticTypes = {
    -- 单元音 (短元音)
    ["ɪ"] = "短元音", ["e"] = "短元音", ["æ"] = "短元音", 
    ["ɒ"] = "短元音", ["ʊ"] = "短元音", ["ʌ"] = "短元音", ["ə"] = "短元音",
    -- 单元音 (长元音)
    ["iː"] = "长元音", ["ɑː"] = "长元音", ["ɔː"] = "长元音", 
    ["uː"] = "长元音", ["ɜː"] = "长元音",
    -- 双元音
    ["eɪ"] = "双元音", ["aɪ"] = "双元音", ["ɔɪ"] = "双元音",
    ["əʊ"] = "双元音", ["aʊ"] = "双元音", ["ɪə"] = "双元音", 
    ["eə"] = "双元音", ["ʊə"] = "双元音",
    -- 辅音
    ["p"] = "爆破音", ["b"] = "爆破音", ["t"] = "爆破音", 
    ["f"] = "摩擦音", ["v"] = "摩擦音", ["θ"] = "摩擦音", 
    ["ð"] = "摩擦音", ["s"] = "摩擦音", ["z"] = "摩擦音", 
    ["ʃ"] = "摩擦音", ["ʒ"] = "摩擦音",
    ["tʃ"] = "破擦音", ["dʒ"] = "破擦音",
    ["m"] = "鼻音", ["n"] = "鼻音", ["ŋ"] = "鼻音",
    -- ...
}
3. 字母组合到音标的映射表
lua

复制
-- 常见字母组合到音标的映射（用于自动识别）
local letterToPhonetic = {
    -- 元音字母组合
    ["ee"] = "/iː/ 长元音",    -- bee, see, tree
    ["ea"] = "/iː/ 长元音",    -- tea, sea, read
    ["oo"] = "/uː/ 长元音",    -- moon, food, school
    ["ou"] = "/aʊ/ 双元音",    -- house, out, mouth
    ["ow"] = "/aʊ/ 双元音",    -- now, how, cow
    ["ai"] = "/eɪ/ 双元音",    -- rain, train, wait
    ["ay"] = "/eɪ/ 双元音",    -- day, play, say
    ["oi"] = "/ɔɪ/ 双元音",    -- oil, join, coin
    ["oy"] = "/ɔɪ/ 双元音",    -- boy, toy, enjoy
    ["ar"] = "/ɑː/ 长元音",    -- car, star, park
    ["or"] = "/ɔː/ 长元音",    -- for, more, door
    ["er"] = "/ɜː/ 长元音",    -- her, term, verb
    ["ir"] = "/ɜː/ 长元音",    -- bird, girl, first
    ["ur"] = "/ɜː/ 长元音",    -- turn, burn, nurse
    
    -- 辅音字母组合
    ["sh"] = "/ʃ/ 摩擦音",     -- she, ship, fish
    ["ch"] = "/tʃ/ 破擦音",    -- chair, teacher, much
    ["th"] = "/θ/ 摩擦音",     -- think, three, math
    ["ng"] = "/ŋ/ 鼻音",       -- sing, ring, long
    ["ck"] = "/k/ 爆破音",     -- back, clock, duck
    ["ph"] = "/f/ 摩擦音",     -- phone, photo, elephant
    ["wh"] = "/w/ 半元音",     -- what, when, where
    ["wr"] = "/r/ 颤音",       -- write, wrong, wrap
    ["kn"] = "/n/ 鼻音",       -- know, knife, knee
    ["mb"] = "/m/ 鼻音",       -- climb, lamb, bomb
    ["gh"] = "不发音",         -- night, light, high
}
4. 元音类型自动检测函数
lua

复制
-- 获取音标中主要元音的类型
local function getMainVowelType(phonetic)
    if not phonetic then return nil end
    
    -- 检查双元音（先检查，因为更长）
    local diphthongs = {"eɪ", "aɪ", "ɔɪ", "əʊ", "aʊ", "ɪə", "eə", "ʊə"}
    for _, d in ipairs(diphthongs) do
        if string.find(phonetic, d) then
            return "双元音 /" .. d .. "/"
        end
    end
    
    -- 检查长元音
    local longVowels = {"iː", "ɑː", "ɔː", "uː", "ɜː"}
    for _, v in ipairs(longVowels) do
        if string.find(phonetic, v) then
            return "长元音 /" .. v .. "/"
        end
    end
    
    -- 检查短元音
    local shortVowels = {"ɪ", "e", "æ", "ɒ", "ʊ", "ʌ", "ə"}
    for _, v in ipairs(shortVowels) do
        if string.find(phonetic, v) then
            return "短元音 /" .. v .. "/"
        end
    end
    
    return nil
end
5. 生成解析文本的核心逻辑
lua

复制
-- 在题目生成函数中构建 explanation 字段
explanation = (function()
    local parts = {"正确答案：" .. word.en}
    
    -- 优先使用词汇表中的手动拆解数据
    if word.breakdown then
        table.insert(parts, "音形拆解：")
        table.insert(parts, "  " .. word.breakdown.letters)   -- 如: st - ar - t
        table.insert(parts, "  " .. word.breakdown.sounds)    -- 如: /st/ - /ɑː/ - /t/
        table.insert(parts, "解析：" .. word.breakdown.tips)   -- 如: ar为长元音/ɑː/
    else
        -- 备用：自动识别主要元音类型
        local vowelType = getMainVowelType(word.phonetic)
        if vowelType then
            table.insert(parts, "解析：主要元音为" .. vowelType)
        end
    end
    
    return table.concat(parts, "\n")
end)()
6. UI 渲染解析内容 (main.lua)
lua

复制
function DrawExplanation(q)
    -- 半透明遮罩
    nvgBeginPath(nvg_)
    nvgRect(nvg_, 0, 0, screenWidth, screenHeight)
    nvgFillColor(nvg_, nvgRGBA(0, 0, 0, 150))
    nvgFill(nvg_)
    
    -- 计算内容行数来动态调整高度
    local lines = SplitLines(q.explanation)  -- 按 \n 分割成多行
    local lineHeight = 30
    
    -- 动态计算卡片尺寸
    local cardWidth = screenWidth * 0.7
    local cardHeight = 80 + (#lines * lineHeight) + 50 + 40
    local cardX = (screenWidth - cardWidth) / 2
    local cardY = (screenHeight - cardHeight) / 2
    
    -- 绘制卡片背景
    nvgBeginPath(nvg_)
    nvgRoundedRect(nvg_, cardX, cardY, cardWidth, cardHeight, 20)
    nvgFillColor(nvg_, nvgRGBA(COLORS.card[1], COLORS.card[2], COLORS.card[3], 255))
    nvgFill(nvg_)
    
    -- 显示结果标题（✓ 回答正确! 或 ✗ 回答错误）
    nvgFontSize(nvg_, 36)
    nvgTextAlign(nvg_, NVG_ALIGN_CENTER + NVG_ALIGN_MIDDLE)
    if lastAnswerCorrect then
        nvgFillColor(nvg_, nvgRGBA(COLORS.correct[1], COLORS.correct[2], COLORS.correct[3], 255))
        nvgText(nvg_, screenWidth / 2, cardY + 50, "✓ 回答正确!", nil)
    else
        nvgFillColor(nvg_, nvgRGBA(COLORS.wrong[1], COLORS.wrong[2], COLORS.wrong[3], 255))
        nvgText(nvg_, screenWidth / 2, cardY + 50, "✗ 回答错误", nil)
    end
    
    -- 逐行绘制解析内容
    nvgFontSize(nvg_, 20)
    nvgFillColor(nvg_, nvgRGBA(255, 255, 255, 255))
    local lineY = cardY + 80 + 20
    for _, line in ipairs(lines) do
        nvgText(nvg_, screenWidth / 2, lineY, line, nil)
        lineY = lineY + lineHeight
    end
    
    -- 底部提示
    nvgFontSize(nvg_, 16)
    nvgFillColor(nvg_, nvgRGBA(COLORS.lightGray[1], COLORS.lightGray[2], COLORS.lightGray[3], 255))
    nvgText(nvg_, screenWidth / 2, cardY + cardHeight - 30, "点击屏幕或按空格继续", nil)
end
系统工作流程总结
┌──────────────────────────────────────────────────────────────┐
│                    音标识别系统工作流程                        │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  1. 词汇数据 (vocabulary.lua)                                 │
│     - 每个单词包含 phonetic 字段（音标）                       │
│     - 可选 breakdown 字段（手动音形拆解）                      │
│       └── letters: "st - ar - t"                             │
│       └── sounds:  "/st/ - /ɑː/ - /t/"                       │
│       └── tips:    "ar为长元音/ɑː/"                           │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  2. 题目生成 (question_generator.lua)                         │
│     - 三种音标题型:                                           │
│       └── PHONETIC_MATCH:    看音标选单词                     │
│       └── WORD_TO_PHONETIC:  看单词选音标                     │
│       └── SPELLING_WITH_PHONETIC: 看音标拼写                  │
│                                                              │
│     - 生成 explanation 时:                                    │
│       └── 优先使用 word.breakdown（手动数据）                  │
│       └── 否则调用 getMainVowelType() 自动识别                │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  3. UI 渲染 (main.lua → DrawExplanation)                      │
│     - 解析文本按 \n 分行显示                                  │
│     - 动态计算卡片高度                                        │
│     - 居中渲染每一行内容                                      │
└──────────────────────────────────────────────────────────────┘
显示效果
截图中显示的内容：

❌ 回答错误
正确答案：/stɑːt/
音形拆解：
  st - ar - t
  /st/ - /ɑː/ - /t/
解析：ar为长元音/ɑː/
这来自 vocabulary.lua 中 “start” 单词的 breakdown 数据：

lua

复制
{en = "start", cn = "开始", phonetic = "/stɑːt/", type = "verb",
    breakdown = {
        letters = "st - ar - t", 
        sounds = "/st/ - /ɑː/ - /t/", 
        tips = "ar为长元音/ɑː/"
    }}
Bot Avatar
等待指示